!function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=!1,"string"==typeof settings&&(method=settings,params=extraSettings),options={id:"",nameSpace:"",root:"",previewHandler:!1,previewInWindow:"",previewInElement:"",previewAutoRefresh:!0,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:!1,previewParserPath:"",previewParserVar:"data",resizeHandle:!0,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]},$.extend(options,settings,extraSettings),options.root||$("script").each(function(e,t){miuScript=$(t).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/),null!==miuScript&&(options.root=miuScript[1])});var uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},matched=uaMatch(navigator.userAgent),browser={};return matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;if($$=$(this),textarea=this,levels=[],abort=!1,scrollPosition=caretPosition=0,caretOffset=-1,options.previewParserPath=localize(options.previewParserPath),options.previewTemplatePath=localize(options.previewTemplatePath),method)switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}else init();function localize(e,t){return t?e.replace(/("|')~\//g,"$1"+options.root):e.replace(/^~\//,options.root)}function init(){id="",nameSpace="",options.id?id='id="'+options.id+'"':$$.attr("id")&&(id='id="markItUp'+$$.attr("id").substr(0,1).toUpperCase()+$$.attr("id").substr(1)+'"'),options.nameSpace&&(nameSpace='class="'+options.nameSpace+'"'),$$.wrap("<div "+nameSpace+"></div>"),$$.wrap("<div "+id+' class="markItUp"></div>'),$$.wrap('<div class="markItUpContainer"></div>'),$$.addClass("markItUpEditor");var e=$('<div class="tab"> <ul> <li class="edit_btn_wrap hover"><a class="edit_btn_a" href="javascript:void(0);"><span>编辑</span></a></li> <li><a class="preview_btn_a" href="javascript:void(0);"><span>预览</span></a></li> </ul><div class="markItUptips"></div></div>');e.find("a").on("click",function(){online_preview(this)}),e.insertBefore($$.parent(".markItUpContainer")),header=$('<div class="markItUpHeader"></div>').insertBefore($$),$(dropMenus(options.markupSet)).appendTo(header),footer=$('<div class="markItUpFooter"></div>').insertAfter($$),!0===options.resizeHandle&&!0!==browser.safari&&(resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var t,o,i=$$.height(),n=e.clientY;t=function(e){return $$.css("height",Math.max(20,e.clientY+i-n)+"px"),!1},o=function(e){return $("html").unbind("mousemove.markItUp",t).unbind("mouseup.markItUp",o),!1},$("html").bind("mousemove.markItUp",t).bind("mouseup.markItUp",o)}),footer.append(resizeHandle)),$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed),$$.bind("insertion.markItUp",function(e,t){!1!==t.target&&get(),textarea===$.markItUp.focused&&markup(t)}),$$.bind("focus.markItUp",function(){$.markItUp.focused=this}),options.previewInElement&&refreshPreview()}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;return $("li:hover > ul",ul).css("display","block"),$.each(markupSet,function(){var button=this,t="",title,li,j;if(title=button.key?(button.name||"")+" [Ctrl+"+button.key+"]":button.name||"",key=button.key?'accesskey="'+button.key+'"':"",button.separator)li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul);else{for(i++,j=levels.length-1;0<=j;j--)t+=levels[j]+"-";li=$('<li class="markItUpButton markItUpButton'+t+i+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return!1}).bind("click.markItUp",function(){return $(this).closest(".markItUpDropMenu > ul").hide(),!1}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){button.call&&eval(button.call)(this);var click_elem=$(this);return click_elem.hasClass("not_prompt")||setTimeout(function(){markup(button)},1),!1}).bind("mouseenter.markItUp",function(){$("> ul",this).show(),$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul),li.hasClass("emoticons")&&li.one("mouseenter",function(){lazy_load_emoticon(this)}),button.dropMenu&&(levels.push(i),$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu)))}}),levels.pop(),ul}function magicMarkups(e){return e?e=(e=(e=e.toString()).replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(e,t){var o=t.split("|!|");return!0===altKey?void 0!==o[1]?o[1]:o[0]:void 0===o[1]?"":o[0]})).replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(e,t){var o=t.split(":!:");return!0!==abort&&(value=prompt(o[0],o[1]?o[1]:""),null===value&&(abort=!0),value)}):""}function prepare(e){return $.isFunction(e)&&(e=e(hash)),magicMarkups(e)}function build(e){var t=prepare(clicked.openWith),o=prepare(clicked.placeHolder),i=prepare(clicked.replaceWith),n=prepare(clicked.closeWith),a=prepare(clicked.openBlockWith),r=prepare(clicked.closeBlockWith),s=clicked.multiline;if(""!==i)block=t+i+n;else if(""===selection&&""!==o)block=t+o+n;else{var l=[e=e||selection],c=[];!0===s&&(l=e.split(/\r?\n/));for(var p=0;p<l.length;p++){var m;line=l[p],(m=line.match(/ *$/))?c.push(t+line.replace(/ *$/g,"")+n+m):c.push(t+line+n)}block=c.join("\n")}return block=a+block+r,{block:block,openBlockWith:a,openWith:t,replaceWith:i,placeHolder:o,closeWith:n,closeBlockWith:r}}function markup(e){var t,o,i,n;if(hash=clicked=e,get(),$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:selection||"",caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey}),prepare(options.beforeInsert),prepare(clicked.beforeInsert),(!0===ctrlKey&&!0===shiftKey||!0===e.multiline)&&prepare(clicked.beforeMultiInsert),$.extend(hash,{line:1}),!0===ctrlKey&&!0===shiftKey){for(lines=selection.split(/\r?\n/),o=0,i=lines.length,n=0;n<i;n++)""!==$.trim(lines[n])?($.extend(hash,{line:++o,selection:lines[n]}),lines[n]=build(lines[n]).block):lines[n]="";string={block:lines.join("\n")},start=caretPosition,t=string.block.length+(browser.opera?i-1:0)}else!0===ctrlKey?(string=build(selection),start=caretPosition+string.openWith.length,t=string.block.length-string.openWith.length-string.closeWith.length,t-=string.block.match(/ $/)?1:0,t-=fixIeBug(string.block)):!0===shiftKey?(string=build(selection),start=caretPosition,t=string.block.length,t-=fixIeBug(string.block)):(string=build(selection),start=caretPosition+string.block.length,t=0,start-=fixIeBug(string.block));""===selection&&""===string.replaceWith&&(caretOffset+=fixOperaBug(string.block),start=caretPosition+string.openBlockWith.length+string.openWith.length,t=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length,caretOffset=$$.val().substring(caretPosition,$$.val().length).length,caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))),$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition}),string.block!==selection&&!1===abort?(insert(string.block),set(start,t)):caretOffset=-1,get(),$.extend(hash,{line:"",selection:selection}),(!0===ctrlKey&&!0===shiftKey||!0===e.multiline)&&prepare(clicked.afterMultiInsert),prepare(clicked.afterInsert),prepare(options.afterInsert),previewWindow&&options.previewAutoRefresh&&refreshPreview(),shiftKey=altKey=ctrlKey=abort=!1}function fixOperaBug(e){return browser.opera?e.length-e.replace(/\n*/g,"").length:0}function fixIeBug(e){return browser.msie?e.length-e.replace(/\r*/g,"").length:0}function insert(e){document.selection?document.selection.createRange().text=e:textarea.value=textarea.value.substring(0,caretPosition)+e+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}function set(e,t){if(textarea.createTextRange){if(browser.opera&&9.5<=browser.version&&0==t)return!1;range=textarea.createTextRange(),range.collapse(!0),range.moveStart("character",e),range.moveEnd("character",t),range.select()}else textarea.setSelectionRange&&textarea.setSelectionRange(e,e+t);textarea.scrollTop=scrollPosition,textarea.focus()}function get(){if(textarea.focus(),scrollPosition=textarea.scrollTop,document.selection)if(selection=document.selection.createRange().text,browser.msie){var e=document.selection.createRange(),t=e.duplicate();for(t.moveToElementText(textarea),caretPosition=-1;t.inRange(e);)t.moveStart("character"),caretPosition++}else caretPosition=textarea.selectionStart;else caretPosition=textarea.selectionStart,selection=textarea.value.substring(caretPosition,textarea.selectionEnd);return selection}function preview(){"function"==typeof options.previewHandler?previewWindow=!0:options.previewInElement?previewWindow=$(options.previewInElement):!previewWindow||previewWindow.closed?options.previewInWindow?(previewWindow=window.open("","preview",options.previewInWindow),$(window).unload(function(){previewWindow.close()})):(iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>'),"after"==options.previewPosition?iFrame.insertAfter(footer):iFrame.insertBefore(header),previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]):!0===altKey&&(iFrame?iFrame.remove():previewWindow.close(),previewWindow=iFrame=!1),options.previewAutoRefresh||refreshPreview(),options.previewInWindow&&previewWindow.focus()}function refreshPreview(){renderPreview()}function renderPreview(){if(options.previewHandler&&"function"==typeof options.previewHandler)options.previewHandler($$.val());else if(options.previewParser&&"function"==typeof options.previewParser){writeInPreview(localize(options.previewParser($$.val()),1))}else""!==options.previewParserPath?$.ajax({type:"POST",dataType:"text",global:!1,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(e){writeInPreview(localize(e,1))}}):template||$.ajax({url:options.previewTemplatePath,dataType:"text",global:!1,success:function(e){writeInPreview(localize(e,1).replace(/<!-- content -->/g,$$.val()))}});return!1}function writeInPreview(e){if(options.previewInElement)$(options.previewInElement).html(e);else if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open(),previewWindow.document.write(e),previewWindow.document.close(),previewWindow.document.documentElement.scrollTop=sp}}function keyPressed(e){if(shiftKey=e.shiftKey,altKey=e.altKey,ctrlKey=(!e.altKey||!e.ctrlKey)&&(e.ctrlKey||e.metaKey),"keydown"===e.type){if(!0===ctrlKey&&(li=$('a[accesskey="'+(13==e.keyCode?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li"),0!==li.length))return ctrlKey=!1,setTimeout(function(){li.triggerHandler("mouseup")},1),!1;if(13===e.keyCode||10===e.keyCode)return!0===ctrlKey?(ctrlKey=!1,markup(options.onCtrlEnter),options.onCtrlEnter.keepDefault):!0===shiftKey?(shiftKey=!1,markup(options.onShiftEnter),options.onShiftEnter.keepDefault):(markup(options.onEnter),options.onEnter.keepDefault);if(9===e.keyCode)return 1!=shiftKey&&1!=ctrlKey&&1!=altKey&&(-1!==caretOffset?(get(),set(caretOffset=$$.val().length-caretOffset,0),!(caretOffset=-1)):(markup(options.onTab),options.onTab.keepDefault))}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor"),$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$),$$.data("markItUp",null)}})},$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})},$.markItUp=function(e){var t={target:!1};if($.extend(t,e),t.target)return $(t.target).each(function(){$(this).focus(),$(this).trigger("insertion",[t])});$("textarea").trigger("insertion",[t])}}(jQuery),mySettings={previewParserPath:"",markupSet:[{name:"Bold",key:"B",openWith:"[b]",closeWith:"[/b]"},{name:"Italic",key:"I",openWith:"[i]",closeWith:"[/i]"},{name:"Underline",key:"U",openWith:"[u]",closeWith:"[/u]"},{separator:"---------------"},{name:"Picture",key:"P",replaceWith:"[img][![Url]!][/img]"},{name:"Link",key:"L",openWith:"[url=[![Url]!]]",closeWith:"[/url]",placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Size",key:"S",openWith:"[size=[![Text size]!]]",closeWith:"[/size]",dropMenu:[{name:"Big",openWith:"[size=200]",closeWith:"[/size]"},{name:"Normal",openWith:"[size=100]",closeWith:"[/size]"},{name:"Small",openWith:"[size=50]",closeWith:"[/size]"}]},{separator:"---------------"},{name:"Bulleted list",openWith:"[list]\n",closeWith:"\n[/list]"},{name:"Numeric list",openWith:"[list=[![Starting number]!]]\n",closeWith:"\n[/list]"},{name:"List item",openWith:"[*] "},{separator:"---------------"},{name:"Quotes",openWith:"[quote]",closeWith:"[/quote]"},{name:"Code",openWith:"[code]",closeWith:"[/code]"},{separator:"---------------"},{name:"Clean",className:"clean",replaceWith:function(e){return e.selection.replace(/\[(.*?)\]/g,"")}},{name:"Preview",className:"preview",call:"preview"}]},jQuery.fn.extend({insertAtCaret:function(n){return this.each(function(e){if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=n,this.focus();else if(this.selectionStart||"0"==this.selectionStart){var t=this.selectionStart,o=this.selectionEnd,i=this.scrollTop;this.value=this.value.substring(0,t)+n+this.value.substring(o,this.value.length),this.focus(),this.selectionStart=t+n.length,this.selectionEnd=t+n.length,this.scrollTop=i}else this.value+=n,this.focus()})}});var openPictureDialog=function(i){var e=$(i.textarea).prev(".markItUpHeader").find(".picture_dialog");if(0===e.length){var n=$('<div class="picture_dialog"></div>');n.append('<span name="close" class="thickbox_close picture_dialog_close" >X</span>');var a=$('<div class="publish"><label><a href="#" id="local-upload">本地上传</a><span style="font-weight:normal"> 或 </span><a href="#" id="remote-upload">网络上传</a> </label><input type="file" class="file_input" name="file" accept="image/png, image/jpeg, image/gif, image/jpg" multiple/><input type="text" class="text" name="url" value="http://" /><a href="#upload" class="btn_1 submit"><span>上传</span></a><p><small style="font-weight: normal;">(请上传单张小于5MB的图片，一次最多上传5张)</small></p></div>'),t=a.find("#local-upload"),o=a.find("#remote-upload"),r=a.find('input[type="file"][name="file"]'),s=a.find('input[type="text"][name="url"]'),l="#306ab3";o.css("font-weight","normal"),o.css("color",l),s.hide(),t.on("click",function(e){e.preventDefault(),$(this).css("font-weight","bold"),$(this).css("color","#000"),o.css("font-weight","normal"),o.css("color",l),r.show(),s.hide()}),o.on("click",function(e){e.preventDefault(),$(this).css("font-weight","bold"),$(this).css("color","#000"),t.css("font-weight","normal"),t.css("color",l),r.hide(),s.show()}),upload_submit=a.find(".submit"),upload_submit.click(function(e){if(e.preventDefault(),""!==CSDN.getUserName()){if(!upload_submit.data("uploading")){var t=$(this).closest("form");upload_submit.after('<img src="/assets/icon_loading.gif" class="icon_loading" />'),upload_submit.data("uploading",!0);var o=t.find('input[type="hidden"][name="_method"]');o.attr("disabled",!0),t.ajaxSubmit({url:CFG.API_URL+"upload_pictures_with_index",type:"post",dataType:"json",maxNumberOfFiles:5,beforeSubmit:function(e){upload_submit.addClass("uploading");for(var t=0,o=!1,i=0;i<e.length;i++){var n=e[i];"file"===n.name&&""!==n.value&&(t++,n.name="file_"+t),"url"===n.name&&n.value&&"http://"!==n.value&&(o=!0)}return e.push({name:"filecount",value:t}),5<t?(alert("最多可一次性上传5张图片"),a.find(".icon_loading").remove(),upload_submit.data("uploading",!1),upload_submit.removeClass("uploading"),r.val(""),!1):o||t?void 0:(alert("上传内容不可为空"),a.find(".icon_loading").remove(),upload_submit.data("uploading",!1),upload_submit.removeClass("uploading"),!1)},success:function(e){if(e.urls){for(var t=0;t<e.urls.length;t++)o=e.urls[t],$(i.textarea).insertAtCaret("[img="+o+"][/img]");n.hide(),r.val(""),s.val("http://")}else alert("上传失败："+e.msg);var o;a.find(".icon_loading").remove(),upload_submit.data("uploading",!1),upload_submit.removeClass("uploading")},error:function(e){data=$.parseJSON(e.responseText),a.find(".icon_loading").remove(),upload_submit.data("uploading",!1),upload_submit.removeClass("uploading"),alert("上传失败："+data.msg)}}),o.attr("disabled",!1)}}else alert("请先登录")}),n.append(a),n.appendTo($(i.textarea).prev(".markItUpHeader")),$(i.textarea).on("click",function(){n.hide()}),$(".picture_dialog_close",n).on("click",function(){n.hide()})}else e.toggle()};function link_open_with(){var e=prompt("链接地址","http://");return null===e?(window.abort_link_input=!0,""):(window.abort_link_input=!1,"[url="+(e=process_link_protocol(e=$.trim(e)))+"]")}function link_close_with(){return!0===window.abort_link_input?"":"[/url]"}function process_link_protocol(e){return/^(http|https):\/\//.test(e)?e:"http://"+e}for(bbcodeSettings={previewParserPath:"",markupSet:[{name:"粗体",openWith:"[b]",closeWith:"[/b]",className:"bbtn_bold"},{name:"斜体",openWith:"[i]",closeWith:"[/i]",className:"bbtn_italic"},{name:"下划线",openWith:"[u]",closeWith:"[/u]",className:"bbtn_underline"},{separator:"---------------"},{name:"字体大小",openWith:"[size=[![Text size]!]]",closeWith:"[/size]",className:"bbtn_size not_prompt",dropMenu:[{name:"12px",openWith:"[size=12px]",closeWith:"[/size]",className:"col1-1"},{name:"13px",openWith:"[size=13px]",closeWith:"[/size]",className:"col1-2"},{name:"14px",openWith:"[size=14px]",closeWith:"[/size]",className:"col1-3"},{name:"16px",openWith:"[size=16px]",closeWith:"[/size]",className:"col2-1"},{name:"18px",openWith:"[size=18px]",closeWith:"[/size]",className:"col2-2"},{name:"24px",openWith:"[size=24px]",closeWith:"[/size]",className:"col2-3"}]},{name:"字体颜色",openWith:"[color=[![Color]!]]",closeWith:"[/color]",className:"bbtn_color not_prompt",dropMenu:[{name:"黑色",openWith:"[color=#000000]",closeWith:"[/color]",className:"col1-1"},{name:"褐色",openWith:"[color=#993300]",closeWith:"[/color]",className:"col1-2"},{name:"橄榄色",openWith:"[color=#333300]",closeWith:"[/color]",className:"col1-3"},{name:"深绿",openWith:"[color=#003300]",closeWith:"[/color]",className:"col1-4"},{name:"深青",openWith:"[color=#003366]",closeWith:"[/color]",className:"col1-5"},{name:"深蓝",openWith:"[color=#000080]",closeWith:"[/color]",className:"col1-6"},{name:"靛蓝",openWith:"[color=#333399]",closeWith:"[/color]",className:"col1-7"},{name:"灰色-80%",openWith:"[color=#333333]",closeWith:"[/color]",className:"col1-8"},{name:"深红",openWith:"[color=#800000]",closeWith:"[/color]",className:"col2-1"},{name:"橙色",openWith:"[color=#FF6600]",closeWith:"[/color]",className:"col2-2"},{name:"深黄",openWith:"[color=#808000]",closeWith:"[/color]",className:"col2-3"},{name:"绿色",openWith:"[color=#008000]",closeWith:"[/color]",className:"col2-4"},{name:"绿色",openWith:"[color=#008080]",closeWith:"[/color]",className:"col2-5"},{name:"蓝色",openWith:"[color=#0000FF]",closeWith:"[/color]",className:"col2-6"},{name:"蓝-灰",openWith:"[color=#666699]",closeWith:"[/color]",className:"col2-7"},{name:"灰色-50%",openWith:"[color=#808080]",closeWith:"[/color]",className:"col2-8"},{name:"红色",openWith:"[color=#FF0000]",closeWith:"[/color]",className:"col3-1"},{name:"浅橙",openWith:"[color=#FF9900]",closeWith:"[/color]",className:"col3-2"},{name:"酸橙",openWith:"[color=#99CC00]",closeWith:"[/color]",className:"col3-3"},{name:"海绿",openWith:"[color=#339966]",closeWith:"[/color]",className:"col3-4"},{name:"水绿色",openWith:"[color=#33CCCC]",closeWith:"[/color]",className:"col3-5"},{name:"浅蓝",openWith:"[color=#3366FF]",closeWith:"[/color]",className:"col3-6"},{name:"紫罗兰",openWith:"[color=#800080]",closeWith:"[/color]",className:"col3-7"},{name:"灰色-40%",openWith:"[color=#999999]",closeWith:"[/color]",className:"col3-8"},{name:"粉红",openWith:"[color=#FF00FF]",closeWith:"[/color]",className:"col4-1"},{name:"金色",openWith:"[color=#FFCC00]",closeWith:"[/color]",className:"col4-2"},{name:"黄色",openWith:"[color=#FFFF00]",closeWith:"[/color]",className:"col4-3"},{name:"鲜绿",openWith:"[color=#00FF00]",closeWith:"[/color]",className:"col4-4"},{name:"青绿",openWith:"[color=#00FFFF]",closeWith:"[/color]",className:"col4-5"},{name:"天蓝",openWith:"[color=#00CCFF]",closeWith:"[/color]",className:"col4-6"},{name:"梅红",openWith:"[color=#993366]",closeWith:"[/color]",className:"col4-7"},{name:"灰色-25%",openWith:"[color=#C0C0C0]",closeWith:"[/color]",className:"col4-8"},{name:"玖瑰红",openWith:"[color=#FF99CC]",closeWith:"[/color]",className:"col5-1"},{name:"茶色",openWith:"[color=#FFCC99]",closeWith:"[/color]",className:"col5-2"},{name:"浅黄",openWith:"[color=#FFFF99]",closeWith:"[/color]",className:"col5-3"},{name:"浅绿",openWith:"[color=#CCFFCC]",closeWith:"[/color]",className:"col5-4"},{name:"浅青绿",openWith:"[color=#CCFFFF]",closeWith:"[/color]",className:"col5-5"},{name:"淡蓝",openWith:"[color=#99CCFF]",closeWith:"[/color]",className:"col5-6"},{name:"淡紫",openWith:"[color=#CC99FF]",closeWith:"[/color]",className:"col5-7"},{name:"白色",openWith:"[color=#FFFFFF]",closeWith:"[/color]",className:"col5-8"}]},{separator:"---------------"},{name:"图片",beforeInsert:openPictureDialog,className:"picture bbtn_picture"},{name:"链接",openWith:link_open_with,closeWith:link_close_with,placeHolder:"",className:"bbtn_link"},{separator:"---------------"},{name:"左对齐",openWith:"[align=left]",closeWith:"[/align]",className:"bbtn_align_left"},{name:"居中对齐",openWith:"[align=center]",closeWith:"[/align]",className:"bbtn_align_center"},{name:"右对齐",openWith:"[align=right]",closeWith:"[/align]",className:"bbtn_align_right"},{separator:"---------------"},{name:"引用",openWith:"[quote]",closeWith:"[/quote]",className:"bbtn_quotes"},{name:"代码",openWith:"[code=[![Code lang]!]]",closeWith:"[/code]",className:"bbtn_code not_prompt",dropMenu:[{name:"C#",openWith:"[code=csharp]",closeWith:"[/code]"},{name:"C/C++",openWith:"[code=c]",closeWith:"[/code]"},{name:"CSS",openWith:"[code=css]",closeWith:"[/code]"},{name:"Delphi/Pascal",openWith:"[code=delphi]",closeWith:"[/code]"},{name:"JavaScript",openWith:"[code=javascript]",closeWith:"[/code]"},{name:"Java",openWith:"[code=java]",closeWith:"[/code]"},{name:"Objective C",openWith:"[code=objc]",closeWith:"[/code]"},{name:"Perl",openWith:"[code=perl]",closeWith:"[/code]"},{name:"PHP",openWith:"[code=php]",closeWith:"[/code]"},{name:"Python",openWith:"[code=python]",closeWith:"[/code]"},{name:"Ruby",openWith:"[code=ruby]",closeWith:"[/code]"},{name:"SQL",openWith:"[code=sql]",closeWith:"[/code]"},{name:"Visual Basic",openWith:"[code=vb]",closeWith:"[/code]"},{name:"HTML",openWith:"[code=html]",closeWith:"[/code]"},{name:"json",openWith:"[code=Json]",closeWith:"[/code]"},{name:"xml",openWith:"[code=xml]",closeWith:"[/code]"},{name:"其他",openWith:"[code=text]",closeWith:"[/code]"}]}]},bbcodeSettings.markupSet.push({separator:"---------------"}),qqMarkupSet={name:"QQ",className:"emoticons emoticons_qq",dropMenu:[]},i=1;i<=134;i++)qqMarkupSet.dropMenu.push({replaceWith:"[face]qq:"+i+".gif[/face]",className:"emoticon emoticon_qq_"+i});for(bbcodeSettings.markupSet.push(qqMarkupSet),monkeyMarkupSet={name:"monkey",className:"emoticons emoticons_monkey",dropMenu:[]},i=1;i<=51;i++)monkeyMarkupSet.dropMenu.push({replaceWith:"[face]monkey:"+i+".gif[/face]",className:"emoticon emoticon_monkey_"+i});for(bbcodeSettings.markupSet.push(monkeyMarkupSet),onionMarkupSet={name:"onion",className:"emoticons emoticons_onion",dropMenu:[]},i=1;i<=86;i++)onionMarkupSet.dropMenu.push({replaceWith:"[face]onion:"+i+".gif[/face]",className:"emoticon emoticon_onion_"+i});function lazy_load_emoticon(e){(e=$(e)).hasClass("emoticons_qq")?change_emoticon_url(e,"https://g.csdnimg.cn/static/face/qq/","qq"):e.hasClass("emoticons_onion")?change_emoticon_url(e,"https://g.csdnimg.cn/static/face/onion/","onion"):e.hasClass("emoticons_monkey")&&change_emoticon_url(e,"https://g.csdnimg.cn/static/face/monkey/","monkey")}function change_emoticon_url(e,t,o){var i,n,a;$("ul > li",e).each(function(){i=$(this),n=i.prop("class").match(new RegExp("emoticon_"+o+"_(\\d+)"))[1],a=t+n+".gif",i.find("a").css("background-image",'url("'+a+'")')})}function online_preview(t){var e=(t=$(t)).closest(".tab").next(".markItUpContainer"),o=!1;"none"==e.css("display")&&(o=!0);var i=!1;if(t.hasClass("preview_btn_a")&&(i=!0),o!=i){var n=e.find("textarea"),a=e.next(".preview_div");a.length||((a=$('<div class="preview_div"></div>')).hide(),e.after(a)),a.css("min-height",e.height()-2);var r=e.prev(".tab").find("li");if(i){if(r.last().addClass("hover"),r.first().removeClass("hover"),e.hide(),a.show(),t.data("processing"))return void a.html("上次预览加载中...");if(""===$.trim(n.val()))return void a.html("");a.html("预览加载中..."),t.data("processing",!0),$.ajax({type:"POST",url:"/preview",data:{body:n.val()}}).success(function(e){a.html(e),a.find("fieldset+br").remove(),a.find("blockquote").each(function(e,t){var o=$(t).find(":first");void 0!==$(t).contents().get(0)&&"br"===$(t).contents().get(0).nodeName.toLowerCase()&&"br"===o.prop("tagName").toLowerCase()&&o.remove()}),syntax_highlighter_with_compatible(),t.data("processing",!1)}).error(function(){t.data("processing",!1),alert("预览出错,请重试")})}else r.first().addClass("hover"),r.last().removeClass("hover"),a.hide(),e.show(),n.focus()}}bbcodeSettings.markupSet.push(onionMarkupSet),bbcodeSettings.markupSet.push({separator:"---------------"}),bbcodeSettings.markupSet.push({name:"清除格式",replaceWith:function(e){return e.selection.replace(/\[(.*?)\]/g,"")},className:"clean bbtn_clean"});