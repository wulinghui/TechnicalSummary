(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{391:function(s,t,a){"use strict";a.r(t);var e=a(7),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm"}},[s._v("#")]),s._v(" Helm")]),s._v(" "),t("p",[s._v("地址：https://github.com/helm/helm")]),s._v(" "),t("p",[s._v("Helm 对于 Kubernetes 来说就相当于 yum 对于 Centos 来说，如果没有 yum 的话，我们在 Centos 下面要安装一些应用程序是极度麻烦的，同样的，对于越来越复杂的 Kubernetes 应用程序来说，如果单纯依靠我们去手动维护应用程序的 YAML 资源清单文件来说，成本也是巨大的。")]),s._v(" "),t("p",[s._v("Helm是Deis (https://deis.com/) 开发的一个用于kubernetes的包管理器。每个包称为一个Chart，一个Chart是一个目录（一般情况下会将目录进行打包压缩，形成name-version.tgz格式的单一文件，方便传输和存储）。")]),s._v(" "),t("p",[s._v("对于应用发布者而言，可以通过Helm打包应用，管理应用依赖关系，管理应用版本并发布应用到软件仓库。")]),s._v(" "),t("p",[s._v("除此以外，Helm还提供了kubernetes上的软件部署，删除，升级，回滚应用的强大功能")]),s._v(" "),t("h2",{attrs:{id:"_1-诞生背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-诞生背景"}},[s._v("#")]),s._v(" 1. 诞生背景")]),s._v(" "),t("p",[s._v("k8s是一个分布式的容器集群管理系统，它将集群中的所有资源都抽象成 API 对象，并且使用声明的方式来创建、修改、删除这些对象。在微服务盛行的今天，如果使用这种方式将导致大量API声明文件的编写维护，使运维工作量爆发式增长，并且对每个微服务应用都需要编写对应的yaml配置文件，极容易出错，维护困难。helm就是为解决这些问题而诞生的。")]),s._v(" "),t("ul",[t("li",[s._v("在云 (Kubernetes)上，部署一个应用往往不是那么简单。如果想要部署一个应用程序到云上，首先要准备好它所需要的环境，打包成 Docker 镜像，进而把镜像放在部署文件 (Deployment) 中、配置服务 (Service)、应用所需的账户 (ServiceAccount) 及权限 (Role)、命名空间 (Namespace)、密钥信息 (Secret)、可持久化存储 (PersistentVolumes) 等资源。也就是编写一系列互相相关的 YAML 配置文件，将它们部署在 Kubernetes 集群上。")]),s._v(" "),t("li",[s._v("即便应用的开发者可以把这些 Docker 镜像存放在公共仓库中，并且将所需的 YAML 资源文件提供给用户，用户仍然需要自己去寻找这些资源文件，并把它们一一部署。倘若用户希望修改开发者提供的默认资源，比如使用更多的副本 (Replicas) 或是修改服务端口 (Port)，他还需要自己去查需要在这些资源文件的哪些地方修改，更不用提版本变更与维护会给开发者和用户造成多少麻烦了。")])]),s._v(" "),t("h2",{attrs:{id:"_2-主要功能"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-主要功能"}},[s._v("#")]),s._v(" 2. 主要功能")]),s._v(" "),t("p",[t("strong",[s._v("Helm主要功能如下：")])]),s._v(" "),t("blockquote",[t("ol",[t("li",[s._v("查找要安装和使用的预打包软件(Chart);")]),s._v(" "),t("li",[s._v("轻松创建和托管自己的软件包;")]),s._v(" "),t("li",[s._v("将软件包安装到任何K8s集群中;")]),s._v(" "),t("li",[s._v("查询集群已安装和正在运行的程序包;")]),s._v(" "),t("li",[s._v("更新、删除、回滚或查看已安装软件包的历史记录;")])])]),s._v(" "),t("p",[t("strong",[s._v("从使用方角度看：")])]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("应用发布者")]),s._v("：可以通过Helm打包应用，管理应用依赖关系，管理应用版本并发布应用到软件仓库。Helm还提供了kubernetes上的软件部署，删除，升级，回滚应用的强大功能。")]),s._v(" "),t("li",[t("strong",[s._v("使用者")]),s._v("：使用Helm后不用需要了解Kubernetes的Yaml语法并编写应用部署文件，可以通过Helm下载并在kubernetes上安装需要的应用。")])]),s._v(" "),t("h2",{attrs:{id:"_3-helm-相关概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-helm-相关概念"}},[s._v("#")]),s._v(" 3. Helm 相关概念")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("helm ：")]),s._v("是一个命令行工具，用于本地开发及管理chart，chart仓库管理等")]),s._v(" "),t("li",[t("code",[s._v("chart：")]),s._v(" Helm 的软件包，采用 TAR 格式，所谓chart就是一系列文件, 它描述了一组相关的 k8s 集群资源")]),s._v(" "),t("li",[t("code",[s._v("release：")]),s._v(" 是运行在 Kubernetes 集群中的 chart 的实例，一个 chart 通常可以在同一个集群中安装多次。每一次安装都会创建一个新的 "),t("em",[s._v("release")]),s._v("。以 MySQL chart为例，如果你想在你的集群中运行两个数据库，你可以安装该chart两次。每一个数据库都会拥有它自己的 "),t("em",[s._v("release")]),s._v(" 和 "),t("em",[s._v("release name")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("Repoistory：")]),s._v("Helm 的软件仓库，Repository 本质上是一个 Web 服务器，该服务器保存了一系列的 Chart 软件包以供用户下载，并且提供了一个该 Repository 的 Chart 包的清单文件以供查询。Helm 可以同时管理多个不同的 Repository。")]),s._v(" "),t("li",[t("code",[s._v("Tiller")]),s._v("：Tiller 是 Helm 的服务端，部署在 Kubernetes 集群中。Tiller 用于接收 Helm 的请求，并根据 Chart 生成 Kubernetes 的部署文件（ Helm 称为 Release ），然后提交给 Kubernetes 创建应用。Tiller 还提供了 Release 的升级、删除、回滚等一系列功能。")])]),s._v(" "),t("h2",{attrs:{id:"_4-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-安装"}},[s._v("#")]),s._v(" 4. 安装")]),s._v(" "),t("p",[s._v("Helm的版本用 x.y.z 描述，x是主版本，y是次版本，z是补丁版本。")]),s._v(" "),t("p",[s._v("不推荐将Helm用于比编译它所依赖的版本更高的Kubernetes版本，因为Helm并没有做出任何向前兼容的保证。如果您选择了一个Kubernetes版本不支持的Helm，需自负风险。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("Helm Version")]),s._v(" "),t("th",{staticStyle:{"text-align":"left"}},[s._v("Supported Kubernetes Versions")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.9.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.24.x - 1.21.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.8.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.23.x - 1.20.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.7.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.22.x - 1.19.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.6.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.21.x - 1.18.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.5.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.20.x - 1.17.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.4.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.19.x - 1.16.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.3.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.18.x - 1.15.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.2.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.18.x - 1.15.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.1.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.17.x - 1.14.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("3.0.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.16.x - 1.13.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.16.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.16.x - 1.15.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.15.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.15.x - 1.14.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.14.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.14.x - 1.13.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.13.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.13.x - 1.12.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.12.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.12.x - 1.11.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.11.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.11.x - 1.10.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.10.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.10.x - 1.9.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.9.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.10.x - 1.9.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.8.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.9.x - 1.8.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.7.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.8.x - 1.7.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.6.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.7.x - 1.6.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.5.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.6.x - 1.5.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.4.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.6.x - 1.5.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.3.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.5.x - 1.4.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.2.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.5.x - 1.4.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.1.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.5.x - 1.4.x")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("2.0.x")]),s._v(" "),t("td",{staticStyle:{"text-align":"left"}},[s._v("1.4.x - 1.3.x")])])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://get.helm.sh/helm-v3.9.0-linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" helm-v3.9.0-linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" linux-amd64/helm  /usr/local/bin/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("所有节点都安装。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#校验是否安装成功")]),s._v("\nhelm version\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#帮助")]),s._v("\nhelm "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--help")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[s._v("注意：由于 Helm V2 版本必须在 Kubernetes 集群中安装一个 Tiller 服务进行通信，这样大大降低了其安全性和可用性，所以在 V3 版本中移除了，helm 3版本，没有Tiller，也就不用安装Tiller")])]),s._v(" "),t("p",[s._v("在Helm 2开发周期中，Helm团队引入了Tiller（Helm2是C/S架构，主要分为客户端helm和服务端 Tiller）。它使多个不同的操作员可以与同一组发行版进行交互，对于在共享集群中工作的团队非常有用。但Kubernetes v1.6默认启用基于角色的访问控制(RBAC)，这之后在生产环境中用Tiller会变得难以管理。同时出于安全策略考虑，Helm 3移除了Tiller，helm 直接和 Kubernetes API 进行通信，安全模型从根本上得以简化。这样做带来的好处有如下几点：")]),s._v(" "),t("ul",[t("li",[s._v("Helm 的架构变的更为简单和灵活")]),s._v(" "),t("li",[s._v("不再需要创建 ServiceAccount，直接使用当前环境中的 kubeconfig 配置")]),s._v(" "),t("li",[s._v("可以直接和 Kubernetes API 交互，更为安全")]),s._v(" "),t("li",[s._v("不再需要使用 helm init 来进行初始化（以前的版本需要使用该命令来向 K8S 集群中安装 Tiller）")])]),s._v(" "),t("h2",{attrs:{id:"_6-仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-仓库"}},[s._v("#")]),s._v(" 6. 仓库")]),s._v(" "),t("p",[s._v("一旦 Helm 客户端准备成功后，我们就可以添加一个 chart 仓库，当然最常用的就是官方的 Helm stable charts 仓库，但是由于官方的 charts 仓库地址需要科学上网，我们可以使用阿里云的 charts 仓库代替：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看仓库")]),s._v("\nhelm repo list\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除原先的仓库")]),s._v("\nhelm repo remove stable\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加新的仓库地址")]),s._v("\nhelm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" stable https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新仓库")]),s._v("\nhelm repo update\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("安装完成后可以用 search 命令来搜索可以安装的 chart 包：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm search repo stable\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_6-1-查找charts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-查找charts"}},[s._v("#")]),s._v(" 6.1 查找Charts")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("helm search hub")]),s._v(" 从 "),t("a",{attrs:{href:"https://artifacthub.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Artifact Hub"),t("OutboundLink")],1),s._v(" 中查找并列出 helm charts。 Artifact Hub中存放了大量不同的仓库")]),s._v(" "),t("li",[t("code",[s._v("helm search repo")]),s._v(" 从你添加（使用 "),t("code",[s._v("helm repo add")]),s._v("）到本地 helm 客户端中的仓库中进行查找。该命令基于本地数据进行搜索，无需连接互联网。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从添加的本地仓库查找")]),s._v("\nhelm search repo mongo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从远端仓库查找")]),s._v("\nhelm search hub wordpress \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("Helm 搜索使用模糊字符串匹配算法，所以你可以只输入名字的一部分")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm search repo mongo")]),s._v("\nNAME                            CHART VERSION   APP VERSION     DESCRIPTION                                       \nbitnami/mongodb                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.1")]),s._v(".2          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".1           MongoDB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("R"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" is a relational "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" NoSQL da"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nbitnami/mongodb-sharded         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.1")]),s._v(".1           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".1           MongoDB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("R"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" is an "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" NoSQL database tha"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/mongodb                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.4")]),s._v(".27          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.7")]),s._v(".1           NoSQL document-oriented database that stores JS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/mongodb-replicaset       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(".1           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.6")]),s._v("             NoSQL document-oriented database that stores JS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_6-2-仓库添加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-仓库添加"}},[s._v("#")]),s._v(" 6.2 仓库添加")]),s._v(" "),t("p",[s._v("可以从官网chart新地址：https://artifacthub.io/，查找仓库。")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("helm repo add")]),s._v(" 命令添加一个 chart 仓库：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" bitnami https://charts.bitnami.com/bitnami\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("当添加完成后，通过 "),t("code",[s._v("helm search repo")]),s._v(" 命令能够看到可以被您安装的charts列表：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm search repo bitnami")]),s._v("\nNAME                                            CHART VERSION   APP VERSION     DESCRIPTION                                       \nbitnami/airflow                                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.1")]),s._v(".4          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(".4           Apache Airflow is a tool to express and execute"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nbitnami/apache                                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.2")]),s._v(".3           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(".54          Apache HTTP Server is an open-source HTTP serve"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nbitnami/argo-cd                                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(".3           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(".11          Argo CD is a continuous delivery tool "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Kuber"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nbitnami/argo-workflows                          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(".3           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v(".9           Argo Workflows is meant to orchestrate Kubernet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nbitnami/aspnet-core                             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(".2           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".8           ASP.NET Core is an open-source framework "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" we"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"_7-使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-使用"}},[s._v("#")]),s._v(" 7. 使用")]),s._v(" "),t("h3",{attrs:{id:"_7-1-安装一个helm包-helm-install"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-安装一个helm包-helm-install"}},[s._v("#")]),s._v(" 7.1 安装一个helm包（helm install）")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("helm install")]),s._v(" 命令来安装一个新的 helm 包。")]),s._v(" "),t("p",[t("strong",[s._v("helm install 命令可以从多个来源进行安装：")])]),s._v(" "),t("ul",[t("li",[s._v("chart 的仓库")]),s._v(" "),t("li",[s._v("本地 chart 压缩包（helm install foo foo-0.1.1.tgz）")]),s._v(" "),t("li",[s._v("解压后的 chart 目录（helm install foo path/to/foo）")]),s._v(" "),t("li",[s._v("完整的 URL（helm install foo https://example.com/charts/foo-1.2.3.tgz）")])]),s._v(" "),t("p",[t("strong",[s._v("从仓库安装")])]),s._v(" "),t("p",[s._v("最简单的使用方法只需要传入两个参数：你命名的release名字和你想安装的chart的名称。")]),s._v(" "),t("p",[s._v("可以使用"),t("code",[s._v("helm repo update")]),s._v("命令来获取最新的chart列表。")]),s._v(" "),t("ul",[t("li",[s._v("安装chart时创建了一个新的 release 对象。如果想让Helm生成一个名称，发布时使用"),t("code",[s._v("--generate-name")]),s._v("。")]),s._v(" "),t("li",[s._v("在安装过程中，helm 客户端会打印一些有用的信息，其中包括：哪些资源已经被创建，release当前的状态，以及你是否还需要执行额外的配置步骤。")]),s._v(" "),t("li",[s._v("Helm 客户端不会等到所有资源都运行才退出。许多 charts 需要大小超过 600M 的 Docker 镜像，可能需要很长时间才能安装到集群中。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动指定名字")]),s._v("\nhelm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" msmysql bitnami/mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#自动生成名字")]),s._v("\nhelm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" bitnami/mysql --generate-name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("比如：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install bitnami/mysql --generate-name")]),s._v("\nNAME: mysql-1662808138\nLAST DEPLOYED: Sat Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":09:00 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\nCHART NAME: mysql\nCHART VERSION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.3")]),s._v(".2\nAPP VERSION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".30\n\n** Please be patient "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" the chart is being deployed **\n\nTip:\n\n  Watch the deployment status using the command: kubectl get pods "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-w")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" default\n\nServices:\n\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Primary: mysql-1662808138.default.svc.cluster.local:3306\n\nExecute the following to get the administrator credentials:\n\n  "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Username: root\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get secret "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" default mysql-1662808138 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.data.mysql-root-password}"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\nTo connect to your database:\n\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Run a pod that you can use as a client:\n\n      kubectl run mysql-1662808138-client "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--rm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--tty")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--restart")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Never'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),s._v("  docker.io/bitnami/mysql:8.0.30-debian-11-r15 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--namespace")]),s._v(" default "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_ROOT_PASSWORD")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--command")]),s._v(" -- "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". To connect to primary "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("read/write"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n\n      mysql "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" mysql-1662808138.default.svc.cluster.local "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-uroot")]),s._v(" -p"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$MYSQL_ROOT_PASSWORD")]),s._v('"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("运行命令之后，bitnami/mysql这个chart被发布。")]),s._v(" "),t("ul",[t("li",[s._v("您可以通过执行 "),t("code",[s._v("helm show chart bitnami/mysql")]),s._v(" 命令简单的了解到这个chart的基本信息。 或者您可以执行 "),t("code",[s._v("helm show all bitnami/mysql")]),s._v(" 获取关于该chart的所有信息。")]),s._v(" "),t("li",[s._v("每当您执行 "),t("code",[s._v("helm install")]),s._v(" 的时候，都会创建一个新的发布版本。 所以一个chart在同一个集群里面可以被安装多次，每一个都可以被独立的管理和升级。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm show chart bitnami/mysql")]),s._v("\nannotations:\n  category: Database\napiVersion: v2\nappVersion: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".30\ndependencies:\n- name: common\n  repository: https://charts.bitnami.com/bitnami\n  tags:\n  - bitnami-common\n  version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".x.x\ndescription: MySQL is a fast, reliable, scalable, and easy to use "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" relational\n  database system. Designed to handle mission-critical, heavy-load production applications.\nhome: https://github.com/bitnami/charts/tree/master/bitnami/mysql\nicon: https://bitnami.com/assets/stacks/mysql/img/mysql-stack-220x234.png\nkeywords:\n- mysql\n- database\n- sql\n- cluster\n- high availability\nmaintainers:\n- name: Bitnami\n  url: https://github.com/bitnami/charts\nname: mysql\nsources:\n- https://github.com/bitnami/containers/tree/main/bitnami/mysql\n- https://mysql.com\nversion: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.3")]),s._v(".2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br")])]),t("h3",{attrs:{id:"_7-2-查看release"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-查看release"}},[s._v("#")]),s._v(" 7.2 查看release")]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("helm list")]),s._v(" 或 "),t("code",[s._v("helm ls")]),s._v(" 命令会列出所有被发布的Chart：")]),s._v(" "),t("ul",[t("li",[s._v("helm list --all 会展示 Helm 保留的所有 release 记录，包括失败或删除的条目（指定了 --keep-history）")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm list")]),s._v("\nNAME                    NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION\nmysql-1662808138        default         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-09-10 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":09:00.680841397 +0800 CST deployed        mysql-9.3.2     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".30 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_7-3-卸载release"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-卸载release"}},[s._v("#")]),s._v(" 7.3 卸载release")]),s._v(" "),t("p",[s._v("可以使用 "),t("code",[s._v("helm uninstall")]),s._v(" 命令卸载你发布的版本")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm uninstall mysql-1662808138")]),s._v("\nrelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql-1662808138"')]),s._v(" uninstalled\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("该命令会从Kubernetes卸载 mysql-1662808138， 它将删除和该版本相关的所有相关资源（service、deployment、 pod等等）甚至版本历史。")]),s._v(" "),t("li",[s._v("如果您在执行 helm uninstall 的时候提供 "),t("code",[s._v("--keep-history")]),s._v(" 选项， Helm将会保存版本历史。 您可以通过命令查看该版本的信息")])]),s._v(" "),t("h3",{attrs:{id:"_7-4-查看release状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-查看release状态"}},[s._v("#")]),s._v(" 7.4 查看release状态")]),s._v(" "),t("p",[s._v("您可以使用 "),t("code",[s._v("helm status")]),s._v(" 命令查看 release 的状态，或是重新读取配置信息：")]),s._v(" "),t("ul",[t("li",[s._v("若卸载Chart时使用了 "),t("code",[s._v("--keep-history")]),s._v(" 选项，helm会跟踪你的版本（即使你卸载了他们），所以你可以审计集群历史甚至使用 "),t("code",[s._v("helm rollback")]),s._v(" 回滚版本。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm status mysql-1662808138")]),s._v("\nError: release: not found\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install bitnami/mysql --generate-name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm uninstall mysql-1662808602 --keep-history  ")]),s._v("\nrelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql-1662808602"')]),s._v(" uninstalled\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm status mysql-1662808602")]),s._v("\nNAME: mysql-1662808602\nLAST DEPLOYED: Sat Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":16:43 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nNAMESPACE: default\nSTATUS: uninstalled\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\nCHART NAME: mysql\nCHART VERSION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.3")]),s._v(".2\nAPP VERSION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.0")]),s._v(".30\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("h3",{attrs:{id:"_7-5-查看配置的仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-5-查看配置的仓库"}},[s._v("#")]),s._v(" 7.5 查看配置的仓库")]),s._v(" "),t("p",[s._v("Helm3 不再附带一个默认的 chart 仓库。helm repo 提供了一组命令用于添加、列出和移除仓库。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("使用 helm repo list 来查看配置的仓库：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm repo list")]),s._v("\nNAME    URL                                                   \nstable  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts\nbitnami https://charts.bitnami.com/bitnami\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("使用 helm repo add 来添加新的仓库：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" xxx\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("p",[s._v("因为 chart 仓库经常在变化，在任何时候你都可以通过执行 "),t("code",[s._v("helm repo update")]),s._v(" 命令来确保你的 Helm 客户端是最新的。")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("helm repo remove")]),s._v(" 命令来移除仓库。")]),s._v(" "),t("h3",{attrs:{id:"_7-6-自定义安装chart"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-6-自定义安装chart"}},[s._v("#")]),s._v(" 7.6 自定义安装chart")]),s._v(" "),t("p",[s._v("上述安装方式只会使用chart的默认配置选项，很多时候，我们需要自定义 chart 来指定我们想要的配置")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 chart 中的可配置选项")]),s._v("\n$ helm show values bitnami/wordpress\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("然后，你可以使用 YAML 格式的文件覆盖上述任意配置项，并在安装过程中使用该文件")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mariadb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" testdb\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" testuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" values.yaml bitnami/wordpress --generate-name\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("上述命令将为 MariaDB 创建一个名称为 "),t("code",[s._v("testuser")]),s._v(" 的默认用户，并且授予该用户访问新建的 "),t("code",[s._v("testdb")]),s._v(" 数据库的权限。chart 中的其他默认配置保持不变。")]),s._v(" "),t("p",[t("strong",[s._v("安装过程中有两种方式传递配置数据")])]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--values")]),s._v(" (或 "),t("code",[s._v("-f")]),s._v(")：使用 YAML 文件覆盖配置。可以指定多次，优先使用最右边的文件")]),s._v(" "),t("li",[t("code",[s._v("--set")]),s._v("：通过命令行的方式对指定项进行覆盖")])]),s._v(" "),t("p",[s._v("如果同时使用两种方式，则 "),t("code",[s._v("--set")]),s._v(" 中的值会被合并到 "),t("code",[s._v("--values")]),s._v(" 中，但是 "),t("code",[s._v("--set")]),s._v(" 中的值优先级更高。在"),t("code",[s._v("--set")]),s._v(" 中覆盖的内容会被被保存在 ConfigMap 中。可以通过 "),t("code",[s._v("helm get values <release-name>")]),s._v(" 来查看指定 release 中 "),t("code",[s._v("--set")]),s._v(" 设置的值。也可以通过运行 "),t("code",[s._v("helm upgrade")]),s._v(" 并指定 "),t("code",[s._v("--reset-values")]),s._v(" 字段来清除 "),t("code",[s._v("--set")]),s._v(" 中设置的值。")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("--set")]),s._v(" 的格式和限制")])]),s._v(" "),t("p",[t("code",[s._v("--set")]),s._v(" 选项使用0或多个 name/value 对。最简单的用法类似于："),t("code",[s._v("--set name=value")]),s._v("，等价于如下 YAML 格式：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" value\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("多个值使用逗号分割，因此 "),t("code",[s._v("--set a=b,c=d")]),s._v(" 的 YAML 表示是：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("a")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" b\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("c")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("支持更复杂的表达式。例如，"),t("code",[s._v("--set outer.inner=value")]),s._v(" 被转换成了：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("outer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" value\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("列表使用花括号（"),t("code",[s._v("{}")]),s._v("）来表示。例如，"),t("code",[s._v("--set name={a, b, c}")]),s._v(" 被转换成了：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" a\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" b\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" c\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("从 2.5.0 版本开始，可以使用数组下标的语法来访问列表中的元素。例如 "),t("code",[s._v("--set servers[0].port=80")]),s._v(" 就变成了：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("多个值也可以通过这种方式来设置。"),t("code",[s._v("--set servers[0].port=80,servers[0].host=example")]),s._v(" 变成了：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如果需要在 "),t("code",[s._v("--set")]),s._v(" 中使用特殊字符，你可以使用反斜线来进行转义；"),t("code",[s._v("--set name=value1\\,value2")]),s._v(" 就变成了：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1,value2"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_7-7-升级release-helm-upgrade"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-7-升级release-helm-upgrade"}},[s._v("#")]),s._v(" 7.7 升级release（helm upgrade）")]),s._v(" "),t("ul",[t("li",[s._v("首先创建好wp-update.yaml")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mariadb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rootPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("wordpressPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("执行命令"),t("code",[s._v("helm upgrade")])])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm upgrade -f wp-update.yaml wordpress-1662809924 bitnami/wordpress")]),s._v("\nRelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wordpress-1662809924"')]),s._v(" has been upgraded. Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nNAME: wordpress-1662809924\nLAST DEPLOYED: Sat Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":42:11 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nTEST SUITE: None\nNOTES:\nCHART NAME: wordpress\nCHART VERSION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.2")]),s._v(".0\nAPP VERSION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("查看结果"),t("code",[s._v("helm get values")])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm get values wordpress-1662809924")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("USER-SUPPLIED VALUES")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mariadb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("auth")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rootPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("wordpressPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_7-8-回滚release-helm-rollback"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-8-回滚release-helm-rollback"}},[s._v("#")]),s._v(" 7.8 回滚release（helm rollback）")]),s._v(" "),t("p",[s._v("格式："),t("code",[s._v("helm rollback [RELEASE] [REVISION]")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm rollback wordpress-1662809924 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("上面这条命令将我们的 "),t("code",[s._v("wordpress-1662809924")]),s._v(" 回滚到了它最初的版本。release 版本其实是一个增量修订（revision）。 每当发生了一次安装、升级或回滚操作，revision 的值就会加1。第一次 revision 的值永远是1。")]),s._v(" "),t("p",[s._v("我们可以使用 "),t("code",[s._v("helm history [RELEASE]")]),s._v(" 命令来查看一个特定 release 的修订版本号")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm history wordpress-1662809924")]),s._v("\nREVISION        UPDATED                         STATUS          CHART                   APP VERSION     DESCRIPTION     \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("               Sat Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":38:45 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("        superseded      wordpress-15.2.0        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".2           Install complete\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("               Sat Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":42:11 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("        deployed        wordpress-15.2.0        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.0")]),s._v(".2           Upgrade complete\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("查看回滚结果：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm get values wordpress-1662809924    ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("-SUPPLIED VALUES:\nmariadb:\n  auth:\n    database: testdb\n    username: testuser\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_7-9-安装、升级、回滚的有用选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-9-安装、升级、回滚的有用选项"}},[s._v("#")]),s._v(" 7.9 安装、升级、回滚的有用选项")]),s._v(" "),t("p",[s._v("要查看所有参数的说明，请执行 "),t("code",[s._v("helm <command> --help")]),s._v(" 命令。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--timeout")]),s._v("：一个 Go duration类型的值， 用来表示等待 Kubernetes 命令完成的超时时间，默认值为 "),t("code",[s._v("5m0s")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("--wait")]),s._v("：表示必须要等到所有的 Pods 都处于 ready 状态，PVC 都被绑定，Deployments 都至少拥有最小 ready 状态 Pods 个数（"),t("code",[s._v("Desired")]),s._v("减去 "),t("code",[s._v("maxUnavailable")]),s._v("），并且 Services 都具有 IP 地址（如果是"),t("code",[s._v("LoadBalancer")]),s._v("， 则为 Ingress），才会标记该 release 为成功。最长等待时间由 "),t("code",[s._v("--timeout")]),s._v(" 值指定。如果达到超时时间，release 将被标记为 "),t("code",[s._v("FAILED")]),s._v("。注意：当 Deployment 的 "),t("code",[s._v("replicas")]),s._v(" 被设置为1，但其滚动升级策略中的 "),t("code",[s._v("maxUnavailable")]),s._v(" 没有被设置为0时，"),t("code",[s._v("--wait")]),s._v(" 将返回就绪，因为已经满足了最小 ready Pod 数。")]),s._v(" "),t("li",[t("code",[s._v("--no-hooks")]),s._v("：不运行当前命令的钩子")]),s._v(" "),t("li",[t("code",[s._v("--recreate-pods")]),s._v("（仅适用于 "),t("code",[s._v("upgrade")]),s._v(" 和 "),t("code",[s._v("rollback")]),s._v("）：这个参数会导致重建所有的 Pod（deployment中的Pod 除外）。（在 Helm 3 中已被废弃）")])]),s._v(" "),t("h2",{attrs:{id:"_8-解决pending问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-解决pending问题"}},[s._v("#")]),s._v(" 8. 解决Pending问题")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe pod mywp-wordpress-f67667857-7ljph")]),s._v("\nEvents:\n  Type     Reason            Age                 From               Message\n  ----     ------            ----                ----               -------\n  Warning  FailedScheduling  58s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x21 over 20m"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  default-scheduler  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/3 nodes are available: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" pod has unbound immediate PersistentVolumeClaims.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("直接安装wordpress并不会成功，因为需要做pvc相关的操作，实际上就是wordpress的包并不会自动创建pv，没有也就是pvc没法和pv绑定造成的问题。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pvc")]),s._v("\nNAME                  STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE\ndata-mywp-mariadb-0   Pending                                                     9s\nmywp-wordpress        Pending                                                     9s\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#有pvc但是没有pv")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pv")]),s._v("\nNo resources found\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("这里涉及到一个k8s新的资源StorageClass")]),s._v(" "),t("h2",{attrs:{id:"_9-storageclass"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-storageclass"}},[s._v("#")]),s._v(" 9. StorageClass")]),s._v(" "),t("p",[s._v("Kubernetes提供了一套可以自动创建PV的机制，即：Dynamic Provisioning。而这个机制的核心在于StorageClass这个API对象。")]),s._v(" "),t("blockquote",[t("p",[s._v("大规模集群中可能会有很多PV，如果这些PV都需要运维手动来处理这也是一件很繁琐的事情（想象一下PVC不停的被提交，运维人员手动去创建符合要求的PV）所以就有了动态供给概念")])]),s._v(" "),t("p",[s._v("StorageClass对象会定义下面两部分内容:")]),s._v(" "),t("ul",[t("li",[s._v("PV的属性。比如，存储类型，Volume的大小等。")]),s._v(" "),t("li",[s._v("创建这种PV需要用到的存储插件。")])]),s._v(" "),t("p",[s._v("有了这两个信息之后，Kubernetes就能够根据用户提交的PVC，找到一个对应的StorageClass，之后Kubernetes就会调用该StorageClass声明的存储插件，进而创建出需要的PV。")]),s._v(" "),t("p",[s._v("通过 StorageClass 的定义，管理员可以将存储资源定义为某种类型的资源，比如快速存储、慢速存储等，用户根据 StorageClass 的描述就可以非常直观的知道各种存储资源的具体特性了，这样就可以根据应用的特性去申请合适的存储资源了。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" standard\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes.io/aws"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("ebs\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gp2\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("reclaimPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Retain\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowVolumeExpansion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountOptions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" debug\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeBindingMode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Immediate\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("每个 StorageClass 都包含 "),t("code",[s._v("provisioner")]),s._v("、"),t("code",[s._v("parameters")]),s._v(" 和 "),t("code",[s._v("reclaimPolicy")]),s._v(" 字段， 这些字段会在 StorageClass 需要动态分配 PersistentVolume 时会使用到。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("provisioner")]),s._v(" "),t("p",[s._v("由那个存储器来提供，比如亚马逊，阿里云，nfs，ceph存储等")])]),s._v(" "),t("li",[t("p",[s._v("parameters")]),s._v(" "),t("p",[s._v("参数，不同的存储提供者，参数也不相同")])]),s._v(" "),t("li",[t("p",[s._v("reclaimPolicy")]),s._v(" "),t("p",[s._v("动态创建的pv的回收策略，默认是Delete，可以是 "),t("code",[s._v("Delete")]),s._v(" 或者 "),t("code",[s._v("Retain")])])])]),s._v(" "),t("p",[s._v("每个 StorageClass 都有一个制备器（Provisioner），用来决定使用哪个卷插件制备 PV。 该字段必须指定。")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[s._v("卷插件")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("内置制备器")]),s._v(" "),t("th",{staticStyle:{"text-align":"center"}},[s._v("配置例子")])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("AWSElasticBlockStore")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#aws-ebs",target:"_blank",rel:"noopener noreferrer"}},[s._v("AWS EBS"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("AzureFile")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#azure-%E6%96%87%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[s._v("Azure File"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("AzureDisk")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#azure-%E7%A3%81%E7%9B%98",target:"_blank",rel:"noopener noreferrer"}},[s._v("Azure Disk"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("CephFS")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("Cinder")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#openstack-cinder",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenStack Cinder"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("FC")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("FlexVolume")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("GCEPersistentDisk")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#gce-pd",target:"_blank",rel:"noopener noreferrer"}},[s._v("GCE PD"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("Glusterfs")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#glusterfs",target:"_blank",rel:"noopener noreferrer"}},[s._v("Glusterfs"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("iSCSI")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("NFS")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#nfs",target:"_blank",rel:"noopener noreferrer"}},[s._v("NFS"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("RBD")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#ceph-rbd",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ceph RBD"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("VsphereVolume")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#vsphere",target:"_blank",rel:"noopener noreferrer"}},[s._v("vSphere"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("PortworxVolume")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("✓")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#portworx-%E5%8D%B7",target:"_blank",rel:"noopener noreferrer"}},[s._v("Portworx Volume"),t("OutboundLink")],1)])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[s._v("Local")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[s._v("-")]),s._v(" "),t("td",{staticStyle:{"text-align":"center"}},[t("a",{attrs:{href:"https://kubernetes.io/zh-cn/docs/concepts/storage/storage-classes/#%E6%9C%AC%E5%9C%B0",target:"_blank",rel:"noopener noreferrer"}},[s._v("Local"),t("OutboundLink")],1)])])])]),s._v(" "),t("h3",{attrs:{id:"_9-1-案例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-案例"}},[s._v("#")]),s._v(" 9.1 案例")]),s._v(" "),t("p",[s._v("还是使用nfs，虽然不默认支持，但是其简单，适合做为例子")]),s._v(" "),t("p",[s._v("前面的课程中已经安装过nfs了")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more /etc/exports")]),s._v("\n/mnt/data/nfs 192.168.200.0/24(rw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash)\n/mnt/data/pv1 192.168.200.0/24(rw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash)\n/mnt/data/pv2 192.168.200.0/24(rw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash)\n/mnt/data/pv3 192.168.200.0/24(rw"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("no_root_squash)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("1. 创建Service Account")])]),s._v(" "),t("p",[s._v("vim nfs-client-rbac.yaml，管理nfs-Provisioner在集群中的权限")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建 Service Account 账户，用来管理 NFS Provisioner 在 k8s 集群中运行的权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建集群角色")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrole\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistentvolumes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistentvolumeclaims"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storage.k8s.io"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storageclasses"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"events"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"endpoints"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#集群角色绑定")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRoleBinding\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrolebinding\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceAccount\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterRole\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("clusterrole\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f nfs-client-rbac.yaml ")]),s._v("\nserviceaccount/nfs-client-provisioner created\nclusterrole.rbac.authorization.k8s.io/nfs-client-provisioner-clusterrole created\nclusterrolebinding.rbac.authorization.k8s.io/nfs-client-provisioner-clusterrolebinding created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("strong",[s._v("2. Deployment创建NFS Provisioner")])]),s._v(" "),t("p",[s._v("vim /etc/kubernetes/manifests/kube-apiserver.yaml")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("spec:\n  containers:\n  - command:\n    - kube-apiserver\n    - --feature-gates"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RemoveSelfLink"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加这行")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("vim nfs-client-provisioner.yaml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Recreate\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#指定Service Account账户")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/external_storage/nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /persistentvolumes\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PROVISIONER_NAME\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage       "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置provisioner的Name，确保该名称与StorageClass资源中的provisioner名称保持一致")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NFS_SERVER\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.200.104           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置绑定的nfs服务器")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NFS_PATH\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /mnt/data/nfs          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置绑定的nfs服务器目录")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#申明nfs数据卷")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.200.104\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /mnt/data/nfs\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f nfs-client-provisioner.yaml")]),s._v("\ndeployment.apps/nfs-client-provisioner created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("3. 创建storageclass")])]),s._v(" "),t("p",[s._v("vim nfs-client-storageclass.yaml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storageclass\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里的名称要和provisioner配置文件中的环境变量PROVISIONER_NAME保持一致")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("archiveOnDelete")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#false表示在删除PVC时不会对数据进行存档，即删除数据")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f nfs-client-storageclass.yaml")]),s._v("\nstorageclass.storage.k8s.io/nfs-client-storageclass created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get storageclasses")]),s._v("\nNAME                      PROVISIONER                            RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE\nnfs-client                cluster.local/nfs-client-provisioner   Delete          Immediate           "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                   122m\nnfs-client-storageclass   nfs-storage                            Delete          Immediate           "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("                  25s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("4. 测试")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("创建pvc")]),s._v(" "),t("p",[s._v("vim test-pvc-pod.yaml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pvc\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteOnce\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClassName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storageclass    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#关联StorageClass对象")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2Gi      \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("应用")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pvc")]),s._v("\nNAME                  STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS              AGE\ntest-nfs-pvc          Bound     pvc-15628120-6425-4223-8558-ffcd3fd43c96   2Gi        RWO            nfs-client-storageclass   13s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pv")]),s._v("\nNAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS              REASON   AGE\npvc-15628120-6425-4223-8558-ffcd3fd43c96   2Gi        RWO            Delete           Bound    default/test-nfs-pvc   nfs-client-storageclass            85s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("自动进行了绑定，自动创建了pv")])]),s._v(" "),t("li",[t("p",[s._v("使用pod进行测试")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /mnt/data/nfs/")]),s._v("\naccess.log  default-test-nfs-pvc-pvc-15628120-6425-4223-8558-ffcd3fd43c96  error.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("vim test-pv-pod.yaml")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pod\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeClaim")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("claimName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pvc\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("container\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http-server"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/share/nginx/html"')]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#与PVC名称保持一致")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f test-pv-pod.yaml")]),s._v("\npod/test-pv-pod created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods")]),s._v("\nNAME                                      READY   STATUS    RESTARTS   AGE\nnfs-client-provisioner-7c74fbb898-vmns7   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          34m\ntest-pv-pod                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          11s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -o wide")]),s._v("\nNAME                                      READY   STATUS    RESTARTS   AGE   IP            NODE    NOMINATED NODE   READINESS GATES\nnfs-client-provisioner-7c74fbb898-vmns7   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          34m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.5    node2   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\ntest-pv-pod     \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("在NFS中编辑index.html")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master default-test-nfs-pvc-pvc-15628120-6425-4223-8558-ffcd3fd43c96"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim index.html")]),s._v("\nthis is storage class\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node1 nfs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.244.1.13")]),s._v("\nthis is storage class\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("完成测试")])])]),s._v(" "),t("h2",{attrs:{id:"_10-helm安装wordpress"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-helm安装wordpress"}},[s._v("#")]),s._v(" 10. helm安装wordpress")]),s._v(" "),t("p",[s._v("安装是设置pvc参数即可:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# helm install wordpress bitnami/wordpress --set mariadb.primary.persistence.enabled=true --set mariadb.primary.persistence.storageClass=nfs-client-storageclass --set persistence.storageClass=nfs-client-storageclass --set service.type=NodePort")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods    ")]),s._v("\nNAME                                      READY   STATUS    RESTARTS       AGE\nnfs-client-provisioner-7c74fbb898-vmns7   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("              51m\nwordpress-5cd4785cdf-l5fsq                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("5m4s ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   6m18s\nwordpress-mariadb-0                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("              6m18s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master helm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service")]),s._v("\nNAME                TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      AGE\nkubernetes          ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1      "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP                      7d20h\nwordpress           NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".15.73    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":31775/TCP,443:30439/TCP   6s\nwordpress-mariadb   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".137.48   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/TCP                     6s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("访问：http://192.168.200.105:31775/ ，发现可以访问")])])}),[],!1,null,null,null);t.default=n.exports}}]);