(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{375:function(s,a,t){"use strict";t.r(a);var e=t(7),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"镜像其他相关操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像其他相关操作"}},[s._v("#")]),s._v(" 镜像其他相关操作")]),s._v(" "),a("h2",{attrs:{id:"_1-镜像备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-镜像备份"}},[s._v("#")]),s._v(" 1. 镜像备份")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("docker save")]),s._v(" 将指定镜像保存成 tar 归档文件。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" IMAGE "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("IMAGE"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" save "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /root/mycentos7.tar mycentos:7\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("-o")]),s._v("：镜像打包后的归档文件输出的目录。")])]),s._v(" "),a("h2",{attrs:{id:"_2-镜像恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-镜像恢复"}},[s._v("#")]),s._v(" 2. 镜像恢复")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("docker load")]),s._v(" 导入 docker save 命令导出的镜像归档文件。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OPTIONS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" load "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" mycentos7.tar\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("--input, -i")]),s._v("：指定导入的文件；")]),s._v(" "),a("li",[a("code",[s._v("--quiet, -q")]),s._v("：精简输出信息。")])]),s._v(" "),a("h2",{attrs:{id:"_3-镜像迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-镜像迁移"}},[s._v("#")]),s._v(" 3. 镜像迁移")]),s._v(" "),a("p",[s._v("镜像迁移同时涉及到了上面两个操作，备份和恢复。")]),s._v(" "),a("p",[s._v("我们可以将任何一个 Docker 镜像从一台机器迁移到另一台机器。在迁移过程中，首先我们要把容器构建为 Docker 镜像。然后，该 Docker 镜像被作为 tar 包文件保存到本地。此时只需要拷贝或移动该镜像到我们想要的机器上，恢复该镜像并运行容器即可。")]),s._v(" "),a("h2",{attrs:{id:"_4-镜像仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-镜像仓库"}},[s._v("#")]),s._v(" 4. 镜像仓库")]),s._v(" "),a("h3",{attrs:{id:"_4-1-注册账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-注册账号"}},[s._v("#")]),s._v(" 4.1 注册账号")]),s._v(" "),a("p",[s._v("官网：https://hub.docker.com/")]),s._v(" "),a("p",[a("img",{attrs:{src:"img/image-20200816174620320-16472332405102.png",alt:"docker"}})]),s._v(" "),a("h3",{attrs:{id:"_4-2-登录账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-登录账号"}},[s._v("#")]),s._v(" 4.2 登录账号")]),s._v(" "),a("p"),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("docker login")]),s._v(" 命令输入账号密码登录 DockerHub。")]),s._v(" "),a("p",[a("img",{attrs:{src:"img/image-20220314124931492.png",alt:"image-20220314124931492"}})]),s._v(" "),a("h3",{attrs:{id:"_4-3-推送镜像至仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-推送镜像至仓库"}},[s._v("#")]),s._v(" 4.3 推送镜像至仓库")]),s._v(" "),a("p",[s._v("需要先创建repository")]),s._v(" "),a("p",[a("img",{attrs:{src:"img/image-20220314174759312.png",alt:"image-20220314174759312"}})]),s._v(" "),a("p",[s._v("先给镜像设置标签 "),a("code",[s._v("docker tag local-image:tagname new-repo:tagname")])]),s._v(" "),a("p",[s._v("再将镜像推送至仓库 "),a("code",[s._v("docker push new-repo:tagname")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mscentos:7 mszlu/test-centos:1.0.0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push mszlu/test-centos:1.0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:"img/image-20220314125225011.png",alt:"image-20220314125225011"}})]),s._v(" "),a("h3",{attrs:{id:"_4-4-查看仓库镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-查看仓库镜像"}},[s._v("#")]),s._v(" 4.4 查看仓库镜像")]),s._v(" "),a("p",[a("img",{attrs:{src:"img/image-20220314184348985.png",alt:"image-20220314184348985"}})]),s._v(" "),a("h3",{attrs:{id:"_4-5-拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-拉取镜像"}},[s._v("#")]),s._v(" 4.5 拉取镜像")]),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("docker pull mszlu/test-centos:1.0.0")]),s._v(" 测试镜像是否可以拉取。")]),s._v(" "),a("h3",{attrs:{id:"_4-6-退出登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-退出登录"}},[s._v("#")]),s._v(" 4.6 退出登录")]),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("docker logout")]),s._v(" 命令退出 DockerHub。")]),s._v(" "),a("h2",{attrs:{id:"_5-私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-私有仓库"}},[s._v("#")]),s._v(" 5. 私有仓库")]),s._v(" "),a("p",[s._v("DockerHub 为我们提供了很多官方镜像和个人上传的镜像，我们可以下载机构或个人提供的镜像，也可以上传我们自己的本地镜像，但缺点是：")]),s._v(" "),a("ul",[a("li",[s._v("由于网络的原因，从 DockerHub 下载和上传镜像速度可能会比较慢；")]),s._v(" "),a("li",[s._v("在生产上使用的 Docker 镜像可能包含我们的代码、配置信息等，不想被外部人员获取，只允许内网的开发人员下载。")])]),s._v(" "),a("p",[s._v("为了解决以上问题，Docker 官方提供了一个叫做 "),a("code",[s._v("registry")]),s._v(" 的镜像用于搭建本地私有仓库使用。在内部网络搭建的 Docker 私有仓库可以使内网人员下载、上传都非常快速，不受外网带宽等因素的影响，同时不在内网的人员也无法下载我们的镜像，并且私有仓库也支持配置仓库认证功能。")]),s._v(" "),a("h3",{attrs:{id:"_5-1-拉取私有仓库镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-拉取私有仓库镜像"}},[s._v("#")]),s._v(" 5.1 拉取私有仓库镜像")]),s._v(" "),a("p",[s._v("拉取私有仓库镜像")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull registry\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_5-2-修改配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-修改配置"}},[s._v("#")]),s._v(" 5.2 修改配置")]),s._v(" "),a("p",[s._v("修改 daemon.json 文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("添加以下内容，用于让 Docker 信任私有仓库地址，保存退出")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.200.101:5000"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("重新加载配置信息及重启 Docker 服务")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载某个服务的配置文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新启动 docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_5-3-创建私有仓库容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-创建私有仓库容器"}},[s._v("#")]),s._v(" 5.3 创建私有仓库容器")]),s._v(" "),a("p",[s._v("创建私有仓库容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-di")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" registry "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mnt/docker/docker_registry:/var/lib/registry registry\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("-d")]),s._v("：后台运行容器；")]),s._v(" "),a("li",[a("code",[s._v("--name")]),s._v("：为创建的容器命名；")]),s._v(" "),a("li",[a("code",[s._v("-p")]),s._v("：表示端口映射，前者是宿主机端口，后者是容器内的映射端口。可以使用多个 -p 做多个端口映射；")]),s._v(" "),a("li",[a("code",[s._v("-v")]),s._v("：将容器内 "),a("code",[s._v("/var/lib/registry")]),s._v(" 目录下的数据挂载至宿主机 "),a("code",[s._v("/mnt/docker/docker_registry")]),s._v(" 目录下；")])]),s._v(" "),a("p",[s._v("打开浏览器输入：http://ip:5000/v2/_catalog 看到 "),a("code",[s._v('{"repositories":[]}')]),s._v(" 表示私有仓库搭建成功。")]),s._v(" "),a("h3",{attrs:{id:"_5-4-推送镜像至私有仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-推送镜像至私有仓库"}},[s._v("#")]),s._v(" 5.4 推送镜像至私有仓库")]),s._v(" "),a("p",[s._v("先给镜像设置标签 "),a("code",[s._v("docker tag local-image:tagname new-repo:tagname")])]),s._v(" "),a("p",[s._v("再将镜像推送至私有仓库 "),a("code",[s._v("docker push new-repo:tagname")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mscentos:7 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.101:5000/test-centos:1.0.0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.101:5000/test-centos:1.0.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("打开浏览器输入：http://192.168.200.101:5000/v2/_catalog 可以看到私有仓库中已上传的镜像。")]),s._v(" "),a("p",[s._v("由于我们做了目录挂载，因此可以在宿主机 "),a("code",[s._v("/mnt/docker/docker_registry/docker/registry/v2/repositories")]),s._v(" 目录下查看。")]),s._v(" "),a("h3",{attrs:{id:"_5-5-配置私有仓库认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-配置私有仓库认证"}},[s._v("#")]),s._v(" 5.5 配置私有仓库认证")]),s._v(" "),a("p",[s._v("私有仓库已经搭建好了，要确保私有仓库的安全性，还需要一个安全认证证书，防止发生意想不到的事情。所以需要在搭建私有仓库的 Docker 主机上先生成自签名证书。")]),s._v(" "),a("p",[s._v("创建证书存储目录")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /usr/local/registry/certs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("生成自签名证书命令")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("openssl req "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-newkey")]),s._v(" rsa:2048 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-nodes")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sha256")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-keyout")]),s._v(" /usr/local/registry/certs/domain.key "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-x509")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-days")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-out")]),s._v(" /usr/local/registry/certs/domain.crt\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("openssl req")]),s._v("：创建证书签名请求等功能；")]),s._v(" "),a("li",[a("code",[s._v("-newkey")]),s._v("：创建 CSR 证书签名文件和 RSA 私钥文件；")]),s._v(" "),a("li",[a("code",[s._v("rsa:2048")]),s._v("：指定创建的 RSA 私钥长度为 2048；")]),s._v(" "),a("li",[a("code",[s._v("-nodes")]),s._v("：对私钥不进行加密；")]),s._v(" "),a("li",[a("code",[s._v("-sha256")]),s._v("：使用 SHA256 算法；")]),s._v(" "),a("li",[a("code",[s._v("-keyout")]),s._v("：创建的私钥文件名称及位置；")]),s._v(" "),a("li",[a("code",[s._v("-x509")]),s._v("：自签发证书格式；")]),s._v(" "),a("li",[a("code",[s._v("-days")]),s._v("：证书有效期；")]),s._v(" "),a("li",[a("code",[s._v("-out")]),s._v("：指定 CSR 输出文件名称及位置；")])]),s._v(" "),a("h4",{attrs:{id:"_5-5-1-生成自签名证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-1-生成自签名证书"}},[s._v("#")]),s._v(" 5.5.1 生成自签名证书")]),s._v(" "),a("p",[s._v("通过 openssl 先生成自签名证书，运行命令以后需要填写一些证书信息，里面最关键的部分是："),a("code",[s._v("Common Name (eg, your name or your server's hostname) []:192.168.200.101")]),s._v("，这里填写的是私有仓库的地址。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openssl req -newkey rsa:2048 -nodes -sha256 -keyout /usr/local/registry/certs/domain.key -x509 -days 365 -out /usr/local/registry/certs/domain.crt")]),s._v("\nGenerating a "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v(" bit RSA private key\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".+++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".+++\nwriting new private key to "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/usr/local/registry/certs/domain.key'")]),s._v("\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.'")]),s._v(", the field will be left blank.\n-----\nCountry Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" letter code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("XX"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":CN\nState or Province Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("full name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":BJ\nLocality Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, city"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Default City"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":BJ\nOrganization Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, company"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Default Company Ltd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":mszlu\nOrganizational Unit Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, section"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":mszlu\nCommon Name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg, your name or your server's "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":192.168.200.101\nEmail Address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":test@mszlu.com\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"_5-5-2-生成鉴权密码文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-2-生成鉴权密码文件"}},[s._v("#")]),s._v(" 5.5.2 生成鉴权密码文件")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建存储鉴权密码文件目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" /usr/local/registry/auth\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果没有 htpasswd 功能需要安装 httpd")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" httpd\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建用户和密码，-c创建文件，-b使用命令行中的密码，而不是提示输入密码，-B强制bcrypt加密密码（非常安全）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 第一次生成时使用-c参数创建用户及密码文件，下次再生成时无需使用-c参数会追加至文件")]),s._v("\nhtpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cbB")]),s._v(" /usr/local/registry/auth/htpasswd root root\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("htpasswd 是 apache http 的基本认证文件，使用 htpasswd 命令可以生成用户及密码文件")]),s._v(" "),a("h4",{attrs:{id:"_5-5-3-创建私有仓库容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-3-创建私有仓库容器"}},[s._v("#")]),s._v(" 5.5.3 创建私有仓库容器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-di")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" registry "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /mydata/docker_registry:/var/lib/registry "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /usr/local/registry/certs:/certs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" /usr/local/registry/auth:/auth "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REGISTRY_AUTH=htpasswd"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REGISTRY_AUTH_HTPASSWD_PATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/auth/htpasswd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REGISTRY_HTTP_TLS_CERTIFICATE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/certs/domain.crt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REGISTRY_HTTP_TLS_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/certs/domain.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n   registry\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"_5-5-4-推送镜像至私有仓库失败"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-4-推送镜像至私有仓库失败"}},[s._v("#")]),s._v(" 5.5.4 推送镜像至私有仓库失败")]),s._v(" "),a("p",[s._v("先给镜像设置标签 "),a("code",[s._v("docker tag local-image:tagname new-repo:tagname")])]),s._v(" "),a("p",[s._v("再将镜像推送至私有仓库 "),a("code",[s._v("docker push new-repo:tagname")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag mscentos:7 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.101:5000/test-centos:1.0.1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".200.101:5000/test-centos:1.0.1\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("如果直接 push 镜像肯定会失败，并且出现 "),a("code",[s._v("no basic auth credentials")]),s._v(" 的错误，这是因为我们没有进行登录认证")]),s._v(" "),a("h4",{attrs:{id:"_5-5-5-登录账号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-5-登录账号"}},[s._v("#")]),s._v(" 5.5.5 登录账号")]),s._v(" "),a("p",[s._v("通过 "),a("code",[s._v("docker login")]),s._v(" 命令输入账号密码登录私有仓库")]),s._v(" "),a("p",[s._v("​\t再次 push 镜像，发现已经可以推送成功了")]),s._v(" "),a("p",[s._v("​\t通过 "),a("code",[s._v("docker logout")]),s._v(" 命令退出账号")])])}),[],!1,null,null,null);a.default=n.exports}}]);