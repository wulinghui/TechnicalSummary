(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{503:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"mybatis-spring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-spring"}},[s._v("#")]),s._v(" Mybatis-Spring")]),s._v(" "),a("p",[s._v("Mybatis整合spring，Mybatis他自己也有一个cglib的代理，有自己的IOC容器，并且是接口就行了(spring是不会扫描接口的BeanDefinition)。 他们是怎么整合的??")]),s._v(" "),a("h2",{attrs:{id:"spring是怎么管理mapper接口的动态代理的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring是怎么管理mapper接口的动态代理的"}},[s._v("#")]),s._v(" Spring是怎么管理Mapper接口的动态代理的")]),s._v(" "),a("h3",{attrs:{id:"_1-3-x版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-x版本"}},[s._v("#")]),s._v(" 1.3.x版本")]),s._v(" "),a("ol",[a("li",[s._v("MapperScan   导入了 MapperScannerRegistrar（实现了ImportBeanDefinitionRegistrar接口）.")]),s._v(" "),a("li",[s._v("registerBeanDefinitions 方法中:  new ClassPathMapperScanner   利用@MapperScan中定义的属性初始化，利用他扫描Mapper")]),s._v(" "),a("li",[s._v("ClassPathMapperScanner   重写了判断BeanDefintion方法isCandidateComponent。 判断接口，是可以扫描到的。")]),s._v(" "),a("li",[s._v("重写了doScan方法，责任链调用super.doScan，再处理BeanDefinitions集合。")]),s._v(" "),a("li",[s._v("修改BeanDefinition几个重要的属性: BeanClass为MapperFactoryBean ， 添加一个构造参数为原始的Class，把AutowireMode修改为byType")]),s._v(" "),a("li",[s._v("MapperFactoryBean 实现了2个重要接口 FactoryBean和InitializingBean接口。")]),s._v(" "),a("li",[s._v("InitializingBean 再实例化时会给configuration.addMapper 往mybatis的configuration注册Mapper.")]),s._v(" "),a("li",[s._v("FactoryBean :  中就是 getSqlSession().getMapper()")]),s._v(" "),a("li",[s._v("MapperFactoryBean的AutowireMode为byType，所以Spring会自动调用set方法，有两个set方法，一个setSqlSessionFactory，一个setSqlSessionTemplate，而这两个方法执行的前提是根据方法参数类型能找到对应的bean，所以Spring容器中要提前存在SqlSessionFactory类型的bean或者SqlSessionTemplate类型的bean。如果你定义的是一个SqlSessionFactory（SqlSessionFactoryBean）类型的bean，那么最终也会被包装为一个SqlSessionTemplate对象，并且赋值给sqlSession属性")]),s._v(" "),a("li",[s._v("而在SqlSessionTemplate类中就存在一个getMapper方法，这个方法中就产生一个Mapper接口代理对象，之后就是Mybatis的流程。")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MapperFactoryBean")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionDaoSupport")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FactoryBean")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("T")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" \n "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionDaoSupport")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DaoSupport")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InitializingBean")]),s._v("\n 继承了"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionDaoSupport")]),s._v("，是他set的"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSession")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"_2-0-x版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-x版本"}},[s._v("#")]),s._v(" 2.0.x版本")]),s._v(" "),a("p",[s._v("新特性: 新增@MapperScans、支持@Repeatable、支持编程式扫描（@Bean : MapperScannerConfigurer）、MyBatisBatchItemWriterBuilder、MyBatisPagingItemReaderBuilder、MyBatisCursorItemReaderBuilder。")]),s._v(" "),a("ol",[a("li",[s._v("MapperScannerRegistrar 注册一个 MapperScannerConfigurer的BeanDefinition（他实现了BeanDefinitionRegistryPostProcessor 扩展点去做的，这样可以兼容spring4.x以下的版本）。")]),s._v(" "),a("li",[s._v("MapperScannerConfigurer 里面执行scan()方法。后续逻辑一样。")])]),s._v(" "),a("h2",{attrs:{id:"如何整合spring事务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何整合spring事务"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://www.cnblogs.com/xing1/p/15212532.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何整合spring事务"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sqlSessionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactoryBean")]),s._v(" factoryBean "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactoryBean")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    factoryBean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setDataSource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dataSource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" factoryBean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactoryBean")]),s._v("  实现了  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("FactoryBean")]),s._v(" ，"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InitializingBean")]),s._v(" ， "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ApplicationListener")]),s._v(" ： \n  "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactory")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Exception")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sqlSessionFactory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("afterPropertiesSet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这里面就用到了 new SpringManagedTransactionFactory(); ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sqlSessionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringManagedTransactionFactory")]),s._v(" ： 里面就用到了 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpringManagedTransaction")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("dataSource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n核心就是"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jdbc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datasource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("DataSourceUtils")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dataSource"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n再往下就是spring的事务内容了。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h2",{attrs:{id:"如何解决线程不安全的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何解决线程不安全的问题"}},[s._v("#")]),s._v(" 如何解决线程不安全的问题")]),s._v(" "),a("p",[s._v("SqlSessionTemplate   -> sqlSessionProxy  -> SqlSessionInterceptor  -> DefaultSqlSession")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactory")]),s._v(" sqlSessionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ExecutorType")]),s._v(" executorType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PersistenceExceptionTranslator")]),s._v(" exceptionTranslator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("notNull")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sqlSessionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'sqlSessionFactory' is required\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("notNull")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("executorType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'executorType' is required\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sqlSessionFactory "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlSessionFactory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("executorType "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" executorType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exceptionTranslator "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" exceptionTranslator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sqlSessionProxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("newProxyInstance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getClassLoader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Class")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionInterceptor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SqlSessionInterceptor")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" 中的 jdk代理 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" invoke方法： 最重要的就是getSqlSession方法"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DefaultSqlSessionFactory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("openSession")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("executorType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 就会调用上面SpringManagedTransactionFactory.newTransaction ")]),s._v("\n之后就是整合spring事务管理的内容了。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("p",[s._v("程序员定义SqlSessionFactoryBean  ， 他将构建SqlSessionFactory，整合spring的事务。")]),s._v(" "),a("p",[s._v("ClassPathMapperScanner : 重写判断bean办法，和修改扫描出来的BeanDefinition的BeanClass为MapperFactoryBean")]),s._v(" "),a("p",[s._v("MapperFactoryBean ： 从上面spring 获得 SqlSession再包装成为sqlSessionTemplate，解决线程安全和整合spring事务的问题。")]),s._v(" "),a("h2",{attrs:{id:"运用的设计模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运用的设计模式"}},[s._v("#")]),s._v(" 运用的设计模式")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("工厂模式")]),s._v(" "),a("th",{staticStyle:{"text-align":"center"}},[s._v("SpringManagedTransactionFactory、SqlSessionFactoryBean、MapperFactoryBean")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("适配器模式")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("SpringManagedTransaction")])]),s._v(" "),a("tr",[a("td",[s._v("装饰模式")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("SqlSessionTemplate、Logger")])]),s._v(" "),a("tr",[a("td",[s._v("模板模式")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("SqlSessionDaoSupport、ClassPathMapperScanner")])]),s._v(" "),a("tr",[a("td",[s._v("代理模式")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("SqlSessionTemplate、getMapper")])]),s._v(" "),a("tr",[a("td",[s._v("责任链模式")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("ClassPathMapperScanner.doScan、SqlSessionInterceptor")])]),s._v(" "),a("tr",[a("td",[s._v("Builder模式")]),s._v(" "),a("td",{staticStyle:{"text-align":"center"}},[s._v("MyBatisBatchItemWriterBuilder、MyBatisPagingItemReaderBuilder、MyBatisCursorItemReaderBuilder")])])])]),s._v(" "),a("h1",{attrs:{id:"tk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tk"}},[s._v("#")]),s._v(" tk")]),s._v(" "),a("p",[s._v("过程类似")]),s._v(" "),a("h1",{attrs:{id:"mybatis-plus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatis-plus"}},[s._v("#")]),s._v(" mybatis-plus")]),s._v(" "),a("p",[s._v("过程类似")])])}),[],!1,null,null,null);a.default=e.exports}}]);