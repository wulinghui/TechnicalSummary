(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{424:function(s,t,a){"use strict";a.r(t);var n=a(7),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"可观测性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可观测性"}},[s._v("#")]),s._v(" 可观测性")]),s._v(" "),t("p",[s._v("Istio 为网格内所有的服务通信生成详细的遥测数据。这种遥测技术提供了服务行为的"),t("strong",[s._v("可观测性")]),s._v("，使运维人员能够排查故障、维护和优化应用程序，而不会给服务的开发人员带来任何额外的负担。通过 Istio，运维人员可以全面了解到受监控的服务如何与其他服务以及 Istio 组件进行交互。")]),s._v(" "),t("p",[s._v("Istio 生成以下类型的遥测数据，以提供对整个服务网格的可观测性：")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://istio.io/latest/zh/docs/concepts/observability/#metrics",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("指标")]),t("OutboundLink")],1),s._v("。Istio 基于 4 个监控的黄金标识（延迟、流量、错误、饱和）生成了一系列服务指标。Istio 还为"),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/ops/deployment/architecture/",target:"_blank",rel:"noopener noreferrer"}},[s._v("网格控制平面"),t("OutboundLink")],1),s._v("提供了更详细的指标。除此以外还提供了一组默认的基于这些指标的网格监控仪表板。\n"),t("ul",[t("li",[s._v("延迟表示服务一个请求所需的时间。这个指标应该分成成功请求（如 HTTP 200）和失败请求（如 HTTP 500）的延迟。")]),s._v(" "),t("li",[s._v("流量是衡量对系统的需求有多大，它是以系统的具体指标来衡量的。例如，每秒的 HTTP 请求，或并发会话，每秒的检索量，等等。")]),s._v(" "),t("li",[s._v("错误用来衡量请求失败的比率（例如 HTTP 500）。")]),s._v(" "),t("li",[s._v("饱和度衡量一个服务中最紧张的资源有多满。例如，线程池的利用率。")])])]),s._v(" "),t("li",[t("a",{attrs:{href:"https://istio.io/latest/zh/docs/concepts/observability/#distributed-traces",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("分布式追踪")]),t("OutboundLink")],1),s._v("。Istio 为每个服务生成分布式追踪 span，运维人员可以理解网格内服务的依赖和调用流程。")]),s._v(" "),t("li",[t("a",{attrs:{href:"https://istio.io/latest/zh/docs/concepts/observability/#access-logs",target:"_blank",rel:"noopener noreferrer"}},[t("strong",[s._v("访问日志")]),t("OutboundLink")],1),s._v("。当流量流入网格中的服务时，Istio 可以生成每个请求的完整记录，包括源和目标的元数据。此信息使运维人员能够将服务行为的审查控制到单个"),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/reference/glossary/#workload-instance",target:"_blank",rel:"noopener noreferrer"}},[s._v("工作负载实例"),t("OutboundLink")],1),s._v("的级别。")])]),s._v(" "),t("h2",{attrs:{id:"_1-指标"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-指标"}},[s._v("#")]),s._v(" 1. 指标")]),s._v(" "),t("p",[s._v("指标（Metric）提供了一种以聚合的方式监控和理解行为的方法。")]),s._v(" "),t("p",[s._v("为了监控服务行为，Istio 为服务网格中所有出入网格，以及网格内部的服务流量都生成了指标。这些指标提供了关于行为的信息，例如总流量数、错误率和请求响应时间。")]),s._v(" "),t("p",[s._v("除了监控网格中服务的行为外，监控网格本身的行为也很重要。Istio 组件可以导出自身内部行为的指标，以提供对网格控制平面的功能和健康情况的洞察能力。")]),s._v(" "),t("h3",{attrs:{id:"_1-1-代理层面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-代理层面"}},[s._v("#")]),s._v(" 1.1 代理层面")]),s._v(" "),t("p",[s._v("Istio 指标收集从 sidecar 代理（Envoy）开始。每个代理为通过它的所有流量（入站和出站）生成一组丰富的指标。代理还提供关于它本身管理功能的详细统计信息，包括配置信息和健康信息。")]),s._v(" "),t("p",[s._v("Envoy 生成的指标提供了资源（例如监听器和集群）粒度上的网格监控。因此，为了监控 Envoy 指标，需要了解网格服务和 Envoy 资源之间的连接。")]),s._v(" "),t("p",[s._v("Istio 允许运维人员在每个工作负载实例上选择生成和收集哪个 Envoy 指标。默认情况下，Istio 只支持 Envoy 生成的统计数据的一小部分，以避免依赖过多的后端服务，还可以减少与指标收集相关的 CPU 开销。然而，运维人员可以在需要时轻松地扩展收集到的代理指标集。这支持有针对性地调试网络行为，同时降低了跨网格监控的总体成本。")]),s._v(" "),t("p",[s._v("下面是几个代理级指标的例子。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("envoy_cluster_internal_upstream_rq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("response_code_class"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2xx"')]),s._v(",cluster_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xds-grpc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7163")]),s._v("\n\nenvoy_cluster_upstream_rq_completed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cluster_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xds-grpc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7164")]),s._v("\n\nenvoy_cluster_ssl_connection_error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cluster_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xds-grpc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nenvoy_cluster_lb_subsets_removed"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cluster_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xds-grpc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nenvoy_cluster_internal_upstream_rq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("response_code"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"503"')]),s._v(",cluster_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xds-grpc"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("blockquote",[t("p",[s._v("注意你可以从每个 Envoy 代理实例的 "),t("code",[s._v("/stats")]),s._v(" 端点查看代理级指标。")])]),s._v(" "),t("h3",{attrs:{id:"_1-2-服务层面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-服务层面"}},[s._v("#")]),s._v(" 1.2 服务层面")]),s._v(" "),t("p",[s._v("除了代理级别指标之外，Istio 还提供了一组用于监控服务通信的面向服务的指标。这些指标涵盖了四个基本的服务监控需求：延迟、流量、错误和饱和情况。Istio 带有一组默认的"),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/tasks/observability/metrics/using-istio-dashboard/",target:"_blank",rel:"noopener noreferrer"}},[s._v("仪表板"),t("OutboundLink")],1),s._v("，用于监控基于这些指标的服务行为。")]),s._v(" "),t("p",[s._v("默认情况下，"),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/concepts/observability/(/zh/docs/reference/config/metrics/)",target:"_blank",rel:"noopener noreferrer"}},[s._v("标准 Istio 指标"),t("OutboundLink")],1),s._v("会导出到 "),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/ops/integrations/prometheus/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Prometheus"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("服务级别指标的使用完全是可选的。运维人员可以选择关闭指标的生成和收集来满足自身需要。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" istio_requests_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("connection_security_policy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mutual_tls"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-world"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_canonical_service")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-world"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_canonical_revision")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_principal")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster.local/ns/default/sa/default"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_service")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-world.default.svc.cluster.local"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_service_name")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-world"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_service_namespace")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_version")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_workload")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-world-v1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("destination_workload_namespace")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("reporter")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"destination"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("request_protocol")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("response_code")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("response_flags")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-web"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_canonical_service")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-web"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_canonical_revision")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_principal")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster.local/ns/default/sa/default"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_version")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_workload")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello-web-v1"')]),s._v(",\n   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("source_workload_namespace")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("981")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h3",{attrs:{id:"_1-3-控制层面"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-控制层面"}},[s._v("#")]),s._v(" 1.3 控制层面")]),s._v(" "),t("p",[s._v("Istio 控制平面还提供了一组自我监控指标。这些指标容许监控 Istio 自己的行为（这与网格内的服务有所不同）。")]),s._v(" "),t("p",[s._v("主要包括pilot，galley等组件指标。")]),s._v(" "),t("p",[s._v("完整指标：https://istio.io/latest/docs/reference/commands/pilot-discovery/#metrics")]),s._v(" "),t("h2",{attrs:{id:"_2-分布式追踪"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-分布式追踪"}},[s._v("#")]),s._v(" 2. 分布式追踪")]),s._v(" "),t("p",[s._v("分布式追踪通过监控流经网格的单个请求，提供了一种监控和理解行为的方法。追踪使网格的运维人员能够理解服务的依赖关系以及在服务网格中的延迟源。")]),s._v(" "),t("p",[s._v("Istio 支持通过 Envoy 代理进行分布式追踪。代理自动为其应用程序生成追踪 span，只需要应用程序转发适当的请求上下文即可。")]),s._v(" "),t("p",[s._v("Istio 支持很多追踪系统，包括 "),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/tasks/observability/distributed-tracing/zipkin/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Zipkin"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/tasks/observability/distributed-tracing/jaeger/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Jaeger"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://istio.io/latest/zh/docs/tasks/observability/distributed-tracing/lightstep/",target:"_blank",rel:"noopener noreferrer"}},[s._v("LightStep"),t("OutboundLink")],1),s._v("、"),t("a",{attrs:{href:"https://www.datadoghq.com/blog/monitor-istio-with-datadog/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Datadog"),t("OutboundLink")],1),s._v("。运维人员控制生成追踪的采样率（每个请求生成跟踪数据的速率）。这允许运维人员控制网格生成追踪数据的数量和速率。")]),s._v(" "),t("h2",{attrs:{id:"_3-访问日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-访问日志"}},[s._v("#")]),s._v(" 3. 访问日志")]),s._v(" "),t("p",[s._v("访问日志提供了一种从单个工作负载实例的角度监控和理解行为的方法。")]),s._v(" "),t("p",[s._v("Istio 能够以一组可配置的格式为服务流量生成访问日志，使操作员可以完全控制日志记录的方式、内容、时间和地点。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-03-06T09:31:27.360Z"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /status/418 HTTP/1.1"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("418")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("135")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.60.0"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d209e46f-9ed5-9b61-bbdd-43e22662702a"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin:8000"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:80"')]),s._v(" inbound"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("httpbin.default.svc.cluster.local - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".146.73:80 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.30")]),s._v(".146.82:38618 outbound_.8000_._.httpbin.default.svc.cluster.local\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_4-prometheus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-prometheus"}},[s._v("#")]),s._v(" 4. Prometheus")]),s._v(" "),t("p",[t("strong",[s._v("Istio 使用 Prometheus 来记录指标，跟踪 Istio 和网格中的应用程序的健康状况")]),s._v("。")]),s._v(" "),t("p",[s._v("要安装 Prometheus，我们可以使用 Istio 安装包中 "),t("code",[s._v("/samples/addons")]),s._v(" 文件夹中的示例安装。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("\ndrwxr-x---  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 bin\n-rw-r--r--  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11348")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 LICENSE\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" root root    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 manifests\n-rw-r-----  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("925")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 manifest.yaml\n-rw-r--r--  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6016")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 README.md\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 samples\ndrwxr-xr-x  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(" Oct "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 tools\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd samples/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master samples"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\naddons    cicd              external      helloworld  kind-lb          open-telemetry  README.md  tcp-echo\nbookinfo  custom-bootstrap  grpc-echo     httpbin     kubernetes-blog  operator        security   websockets\ncerts     extauthz          health-check  jwt-server  multicluster     ratelimit       "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master samples"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd addons/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nextras  grafana.yaml  jaeger.yaml  kiali.yaml  prometheus.yaml  README.md\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("prometheus.yaml是安装prometheus的yaml文件")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105184552885.png",alt:"image-20221105184552885"}})]),s._v(" "),t("p",[s._v("命名空间是"),t("code",[s._v("istio-system")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f prometheus.yaml ")]),s._v("\nserviceaccount/prometheus created\nconfigmap/prometheus created\nclusterrole.rbac.authorization.k8s.io/prometheus created\nclusterrolebinding.rbac.authorization.k8s.io/prometheus created\nservice/prometheus created\ndeployment.apps/prometheus created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deploy -n istio-system ")]),s._v("\nNAME                   READY   UP-TO-DATE   AVAILABLE   AGE\nistio-egressgateway    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           22h\nistio-ingressgateway   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           22h\nistiod                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           22h\nprometheus             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           3h27m\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n istio-system -o wide ")]),s._v("\nNAME                                   READY   STATUS    RESTARTS      AGE     IP               NODE    NOMINATED NODE   READINESS GATES\nistio-egressgateway-df6f6d597-dcfdq    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("11h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   22h     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.181   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nistio-ingressgateway-577d9994f-jh2gz   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("11h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   22h     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.188   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nistiod-64775594cd-zd7vk                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("11h ago"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   22h     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.159   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nprometheus-6549d6bdcc-fcbn5            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             3h27m   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".166.184   node1   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("可以看到prometheus运行起来了")]),s._v(" "),t("p",[s._v("访问，需求修改svc为NodePort：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service -n istio-system -o wide ")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE     SELECTOR\nprometheus             ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".23.188    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v("/TCP                                                                     3h28m   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus,component"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server,release"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit service prometheus -n istio-system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  type: NodePort\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get service -n istio-system -o wide        ")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE     SELECTOR\nprometheus             NodePort       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".23.188    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v(":31244/TCP                                                               3h30m   "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus,component"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server,release"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prometheus\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("访问：http://192.168.200.101:31244/")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105221736583.png",alt:"image-20221105221736583"}})]),s._v(" "),t("blockquote",[t("p",[s._v("又看到熟悉的Prometheus的界面了")])]),s._v(" "),t("p",[s._v("我们部署一个测试应用，来去观察Prometheus中的指标")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment nginx --image=hub.c.163.com/library/nginx:latest -n microservice")]),s._v("\ndeployment.apps/nginx created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose deployment nginx --type=NodePort --name=nginxsvc --port=80 -n microservice")]),s._v("\nservice/nginxsvc exposed\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n microservice")]),s._v("\nNAME                     READY   STATUS    RESTARTS   AGE\nnginx-84bf5c6c49-fxbzw   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          23s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n microservice    ")]),s._v("\nNAME       TYPE       CLUSTER-IP   EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nnginxsvc   NodePort   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".2.27   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":31456/TCP   12s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("访问：http://192.168.200.101:31456/")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105222201408.png",alt:"image-20221105222201408"}})]),s._v(" "),t("p",[s._v("在Prometheus中输入"),t("code",[s._v("istio_requests_total")])]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105222306865.png",alt:"image-20221105222306865"}})]),s._v(" "),t("h2",{attrs:{id:"_5-grafana"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-grafana"}},[s._v("#")]),s._v(" 5. Grafana")]),s._v(" "),t("p",[s._v("通过 Grafana，我们可以"),t("strong",[s._v("监控 Istio 和服务网格中运行的应用程序的健康状况")]),s._v("。")]),s._v(" "),t("p",[s._v("可以使用 "),t("code",[s._v("grafana.yaml")]),s._v(" 来部署带有预配置仪表盘的 Grafana 示例安装。该 YAML 文件在 Istio 安装包的 "),t("code",[s._v("/samples/addons")]),s._v(" 下。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f grafana.yaml ")]),s._v("\nserviceaccount/grafana created\nconfigmap/grafana created\nservice/grafana created\ndeployment.apps/grafana created\nconfigmap/istio-grafana-dashboards created\nconfigmap/istio-services-grafana-dashboards created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n istio-system")]),s._v("\nNAME                                   READY   STATUS    RESTARTS      AGE\ngrafana-96dd4774d-d2fr9                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             29s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("Kubernetes 将 Grafana 部署在 "),t("code",[s._v("istio-system")]),s._v(" 命名空间")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 需要修改其为NodePort来外部访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  kubectl get service -n istio-system ")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\ngrafana                ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".229.157   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("/TCP \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit service grafana -n istio-system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  kubectl get service -n istio-system         ")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\ngrafana                NodePort       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".229.157   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":32393/TCP \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("访问http://192.168.200.101:32393/")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105222948750.png",alt:"image-20221105222948750"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223022713.png",alt:"image-20221105223022713"}})]),s._v(" "),t("p",[s._v("Istio Control Plane Dashboard 仪表盘向我们展示控制平面的资源使用情况（内存、CPU、磁盘、Go routines），以及关于 Pilot、Envoy 和 Webhook 的信息。")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223030522.png",alt:"image-20221105223030522"}})]),s._v(" "),t("p",[t("strong",[s._v("Istio 网格仪表盘")]),s._v("（Istio Mesh Dashboard）为我们提供了在网格中运行的所有服务的概览。仪表盘包括全局请求量、成功率以及 4xx 和 5xx 响应的数量。")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223403019.png",alt:"image-20221105223403019"}})]),s._v(" "),t("p",[t("strong",[s._v("Istio 性能仪表盘")]),s._v("（Istio Performance Dashboard）向我们展示了 Istio 主要组件在稳定负载下的资源利用率。")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223438895.png",alt:"image-20221105223438895"}})]),s._v(" "),t("p",[t("strong",[s._v("Istio 服务仪表盘")]),s._v("（Istio Service Dashboard）允许我们在网格中查看服务的细节。")]),s._v(" "),t("p",[s._v("我们可以获得关于请求量、成功率、持续时间的信息，以及显示按来源和响应代码、持续时间和大小的传入请求的详细图表。")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223520635.png",alt:"image-20221105223520635"}})]),s._v(" "),t("p",[t("strong",[s._v("Istio Wasm 扩展仪表盘")]),s._v("（Istio Wasm Extension Dashboard）显示与 WebAssembly 模块有关的指标。从这个仪表盘，我们可以监控活动的和创建的 Wasm 虚拟机，关于获取删除 Wasm 模块和代理资源使用的数据")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223556800.png",alt:"image-20221105223556800"}})]),s._v(" "),t("p",[t("strong",[s._v("Istio 工作负载仪表盘")]),s._v("（Istio Workload Dashboard）为我们提供了一个工作负载的详细指标分类")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105223623199.png",alt:"image-20221105223623199"}})]),s._v(" "),t("h2",{attrs:{id:"_6-zipkin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-zipkin"}},[s._v("#")]),s._v(" 6. Zipkin")]),s._v(" "),t("p",[t("a",{attrs:{href:"http://zipkin.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Zipkin"),t("OutboundLink")],1),s._v(" 是一个分布式追踪系统。")]),s._v(" "),t("p",[s._v("分布式追踪，也称为分布式请求追踪，是一种用于分析和监视应用程序的方法，特别是那些使用微服务体系结构构建的应用程序。")]),s._v(" "),t("p",[s._v("分布式追踪有助于查明故障发生的位置以及导致性能低下的原因，开发人员可以使用分布式跟踪来帮助调试和优化他们的代码。")]),s._v(" "),t("p",[t("strong",[s._v("每当一个请求进入服务网格时，Envoy 都会生成一个唯一的请求 ID 和追踪信息，并将其作为 HTTP 头的一部分来存储")]),s._v("。任何应用程序都可以将这些头信息转发给它所调用的其他服务，以便在系统中创建一个完整的追踪。")]),s._v(" "),t("blockquote",[t("p",[s._v("尽管所有的请求都要经过 Istio sidecar，但 Istio 没有办法将出站请求与产生这些请求的入站请求联系起来。通过在应用程序中传播相关的头信息可以帮助 Zipkin 将这些跟踪信息拼接起来。")])]),s._v(" "),t("p",[s._v("Istio 依赖于 B3 跟踪头（以 "),t("code",[s._v("x-b3")]),s._v(" 开头的 header）和 Envoy 生成的请求 ID（"),t("code",[s._v("x-request-id")]),s._v("）。B3 头信息用于跨服务边界的跟踪上下文传播。")]),s._v(" "),t("p",[s._v("以下是我们需要在我们的应用程序中对每个发出的请求进行传播的特定头文件名称：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" x-request-id\n x-b3-traceid\n x-b3-spanid\n x-b3-parentspanid\n x-b3-sampled\n x-b3-flags\n b3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("安装Zipkin，可以使用 addons 文件夹中的 "),t("code",[s._v("zipkin.yaml")]),s._v(" 文件。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd extras/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master extras"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nprometheus-operator.yaml  prometheus_vm_tls.yaml  prometheus_vm.yaml  zipkin.yaml\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master extras"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f zipkin.yaml ")]),s._v("\ndeployment.apps/zipkin created\nservice/tracing created\nservice/zipkin created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master extras"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n istio-system ")]),s._v("\nNAME                                   READY   STATUS    RESTARTS      AGE\nzipkin-69c6898b88-l2c84                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             31s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("同样，将svc的类型改为NodePort访问")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master extras"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit service zipkin -n istio-system ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master extras"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\ngrafana                NodePort       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".229.157   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":32393/TCP                                                               21m\nistio-egressgateway    ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".223.169   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP,443/TCP                                                               23h\nistio-ingressgateway   LoadBalancer   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.106")]),s._v(".242.96    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pending"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v(":32522/TCP,80:30539/TCP,443:31132/TCP,31400:30377/TCP,15443:30383/TCP   23h\nistiod                 ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".227.243    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15010")]),s._v("/TCP,15012/TCP,443/TCP,15014/TCP                                        23h\nprometheus             NodePort       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".23.188    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v(":31244/TCP                                                               4h1m\ntracing                ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".234.18    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP                                                                       116s\nzipkin                 NodePort       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".25.63     "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9411")]),s._v(":31326/TCP  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("访问：http://192.168.200.101:31326/")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105224844629.png",alt:"image-20221105224844629"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105225527364.png",alt:"image-20221105225527364"}})]),s._v(" "),t("h2",{attrs:{id:"_7-kiali"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-kiali"}},[s._v("#")]),s._v(" 7. Kiali")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.kiali.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kiali"),t("OutboundLink")],1),s._v("  是一款 istio 服务网格可视化工具，提供了服务拓补图、全链路跟踪、指标遥测、配置校验、健康检查等功能。")]),s._v(" "),t("p",[s._v("安装 Kiali，使用 addons 文件夹中的 "),t("code",[s._v("kiali.yaml")]),s._v(" 文件：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nextras  grafana.yaml  jaeger.yaml  kiali.yaml  prometheus.yaml  README.md\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f kiali.yaml ")]),s._v("\nserviceaccount/kiali created\nconfigmap/kiali created\nclusterrole.rbac.authorization.k8s.io/kiali-viewer created\nclusterrole.rbac.authorization.k8s.io/kiali created\nclusterrolebinding.rbac.authorization.k8s.io/kiali created\nrole.rbac.authorization.k8s.io/kiali-controlplane created\nrolebinding.rbac.authorization.k8s.io/kiali-controlplane created\nservice/kiali created\ndeployment.apps/kiali created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n istio-system ")]),s._v("\nNAME                                   READY   STATUS    RESTARTS      AGE\nkiali-575f548888-kkrgn                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("             30s\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system    ")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                               23h\nkiali                  ClusterIP      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".120.89    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20001")]),s._v("/TCP,9090/TCP \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("同样，将其修改为NodePort来进行外部访问")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit service kiali -n istio-system")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master addons"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system            ")]),s._v("\nNAME                   TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\nkiali                  NodePort       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".120.89    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20001")]),s._v(":30045/TCP,9090:31042/TCP                                               106s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("访问：http://192.168.200.101:30045/")]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105230327130.png",alt:"image-20221105230327130"}})]),s._v(" "),t("p",[t("img",{attrs:{src:"img/image-20221105230436938.png",alt:"image-20221105230436938"}})])])}),[],!1,null,null,null);t.default=e.exports}}]);