(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{420:function(s,e,t){"use strict";t.r(e);var n=t(7),a=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"istio安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#istio安装"}},[s._v("#")]),s._v(" Istio安装")]),s._v(" "),e("p",[s._v("Istio的安装官方提供了多种方式")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/install/istioctl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 Istioctl 安装"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/install/helm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 Helm 安装"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/install/operator/",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 Istio Operator 安装"),e("OutboundLink")],1)])]),s._v(" "),e("blockquote",[e("p",[s._v("三种方式中，Istioctl是社区推荐的方式。Operator方式新特性不会优先考虑，也就是说如果想使用最新版本，不能使用Operator方式。Helm方式符合公共标准，不管是Istioctl，helm，operator方式底层都是使用相同的chart，缺点是Helm方式相对比较复杂")])]),s._v(" "),e("h2",{attrs:{id:"_1-istioctl安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-istioctl安装"}},[s._v("#")]),s._v(" 1. Istioctl安装")]),s._v(" "),e("p",[s._v("官方文档地址：https://istio.io/latest/zh/docs/setup/install/istioctl/")]),s._v(" "),e("h3",{attrs:{id:"_1-1-下载istio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-下载istio"}},[s._v("#")]),s._v(" 1.1 下载Istio")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定版本下载")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" https://istio.io/downloadIstio "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ISTIO_VERSION")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("目前1.15.3是最新版本，当然在实际生产部署中，不推荐使用最新版本，建议是选择相对稳定的版本")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置代理进行下载")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# export https_proxy=http://192.168.124.4:10809")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.15.3 sh -")]),s._v("\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00:01  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00:01 --:--:--    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4856")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4856")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1540")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00:03  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00:03 --:--:--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8415")]),s._v("\n\nDownloading istio-1.15.3 from https://github.com/istio/istio/releases/download/1.15.3/istio-1.15.3-linux-amd64.tar.gz "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nIstio "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3 Download Complete"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd istio-1.15.3/")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v("\ndrwxr-x---  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 bin\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("11348")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 LICENSE\ndrwxr-xr-x  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" root root    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 manifests\n-rw-r-----  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("925")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 manifest.yaml\n-rw-r--r--  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6016")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 README.md\ndrwxr-xr-x "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" root root  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 samples\ndrwxr-xr-x  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(" Oct "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 tools\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("ul",[e("li",[e("code",[s._v("bin")]),s._v(" : 存放 "),e("code",[s._v("istioctl")]),s._v(" 二进制文件")]),s._v(" "),e("li",[e("code",[s._v("manifests")]),s._v(" : istio 的内置 "),e("code",[s._v("chart")]),s._v(" 目录，默认使用这些内置 chart 生成安装清单，安装过程也可以自行设置 "),e("code",[s._v("--manifests=other_manifests/")]),s._v(" 参数来指定外部 chart")]),s._v(" "),e("li",[e("code",[s._v("samples")]),s._v(" : istio 提供的一些示例应用程序")]),s._v(" "),e("li",[e("code",[s._v("tools")]),s._v(" : 一些工具，如 "),e("code",[s._v("certs")]),s._v(" 用于生成证书")])]),s._v(" "),e("p",[s._v("为了方便使用 "),e("code",[s._v("istioctl")]),s._v(" ，将 "),e("code",[s._v("bin")]),s._v(" 目录添加到我们的环境变量中：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  export PATH=$PWD/bin:$PATH")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl version")]),s._v("\nno running Istio pods "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"istio-system"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("加入"),e("code",[s._v("/etc/profile")]),s._v("永久生效")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/profile")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mnt/k8s/istio/istio-1.15.3/bin:"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source /etc/profile")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h3",{attrs:{id:"_1-2-执行安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-执行安装"}},[s._v("#")]),s._v(" 1.2 执行安装")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## istio提供的几种内置配置，这些配置文件提供了对 Istio 控制平面和 Istio 数据平面 Sidecar 的定制内容。")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl profile list")]),s._v("\nIstio configuration profiles:\n    default\n    demo\n    empty\n    external\n    minimal\n    openshift\n    preview\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("ol",[e("li",[e("p",[e("strong",[s._v("default")]),s._v("：根据 "),e("code",[s._v("IstioOperator")]),s._v(" API 的默认设置启动组件。 建议用于生产部署和 "),e("a",{attrs:{href:"https://istio.io/latest/zh/docs/ops/deployment/deployment-models/#multiple-clusters",target:"_blank",rel:"noopener noreferrer"}},[s._v("Multicluster Mesh"),e("OutboundLink")],1),s._v(" 中的 Primary Cluster。")]),s._v(" "),e("p",[s._v("您可以运行 "),e("code",[s._v("istioctl profile dump")]),s._v(" 命令来查看默认设置。")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("demo")]),s._v("：这一配置具有适度的资源需求，旨在展示 Istio 的功能。 它适合运行 "),e("a",{attrs:{href:"https://istio.io/latest/zh/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),e("OutboundLink")],1),s._v(" 应用程序和相关任务。")]),s._v(" "),e("p",[s._v("此配置文件启用了高级别的追踪和访问日志，因此不适合进行性能测试。")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("minimal")]),s._v("：与默认配置文件相同，但只安装了控制平面组件。 它允许您使用 "),e("a",{attrs:{href:"https://istio.io/latest/zh/docs/setup/upgrade/gateways/#installation-with-istioctl",target:"_blank",rel:"noopener noreferrer"}},[s._v("Separate Profile"),e("OutboundLink")],1),s._v(" 配置控制平面和数据平面组件(例如 Gateway)。")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("remote")]),s._v("：配置 "),e("a",{attrs:{href:"https://istio.io/latest/zh/docs/ops/deployment/deployment-models/#multiple-clusters",target:"_blank",rel:"noopener noreferrer"}},[s._v("Multicluster Mesh"),e("OutboundLink")],1),s._v(" 的 Remote Cluster。")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("empty")]),s._v("：不部署任何东西。可以作为自定义配置的基本配置文件。")])]),s._v(" "),e("li",[e("p",[e("strong",[s._v("preview")]),s._v("：预览文件包含的功能都是实验性。这是为了探索 Istio 的新功能。不确保稳定性、安全性和性能（使用风险需自负）。")])])]),s._v(" "),e("p",[s._v("标注 ✔ 的组件安装在每个配置文件中：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th"),s._v(" "),e("th",[s._v("default")]),s._v(" "),e("th",[s._v("demo")]),s._v(" "),e("th",[s._v("minimal")]),s._v(" "),e("th",[s._v("remote")]),s._v(" "),e("th",[s._v("empty")]),s._v(" "),e("th",[s._v("preview")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("核心组件")]),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td",[e("code",[s._v("istio-egressgateway")])]),s._v(" "),e("td"),s._v(" "),e("td",[s._v("✔")]),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td")]),s._v(" "),e("tr",[e("td",[e("code",[s._v("istio-ingressgateway")])]),s._v(" "),e("td",[s._v("✔")]),s._v(" "),e("td",[s._v("✔")]),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td",[s._v("✔")])]),s._v(" "),e("tr",[e("td",[e("code",[s._v("istiod")])]),s._v(" "),e("td",[s._v("✔")]),s._v(" "),e("td",[s._v("✔")]),s._v(" "),e("td",[s._v("✔")]),s._v(" "),e("td"),s._v(" "),e("td"),s._v(" "),e("td",[s._v("✔")])])])]),s._v(" "),e("blockquote",[e("p",[s._v("这里我们使用demo")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.15.3"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl profile dump demo")]),s._v("\napiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nspec:\n  components:\n    base:\n      enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    cni:\n      enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    egressGateways:\n    - enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      k8s:\n        resources:\n          requests:\n            cpu: 10m\n            memory: 40Mi\n      name: istio-egressgateway\n    ingressGateways:\n    - enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      k8s:\n        resources:\n          requests:\n            cpu: 10m\n            memory: 40Mi\n        service:\n          ports:\n          - name: status-port\n            port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v("\n            targetPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v("\n          - name: http2\n            port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n            targetPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n          - name: https\n            port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n            targetPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8443")]),s._v("\n          - name: tcp\n            port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31400")]),s._v("\n            targetPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("31400")]),s._v("\n          - name: tls\n            port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15443")]),s._v("\n            targetPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15443")]),s._v("\n      name: istio-ingressgateway\n    istiodRemote:\n      enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    pilot:\n      enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      k8s:\n        env:\n        - name: PILOT_TRACE_SAMPLING\n          value: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),s._v("\n        resources:\n          requests:\n            cpu: 10m\n            memory: 100Mi\n  hub: docker.io/istio\n  meshConfig:\n    accessLogFile: /dev/stdout\n    defaultConfig:\n      proxyMetadata: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    enablePrometheusMerge: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    extensionProviders:\n    - envoyOtelAls:\n        port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4317")]),s._v("\n        service: opentelemetry-collector.istio-system.svc.cluster.local\n      name: otel\n  profile: demo\n  tag: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3\n  values:\n    base:\n      enableCRDTemplates: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      validationURL: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    defaultRevision: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    gateways:\n      istio-egressgateway:\n        autoscaleEnabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n        env: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        name: istio-egressgateway\n        secretVolumes:\n        - mountPath: /etc/istio/egressgateway-certs\n          name: egressgateway-certs\n          secretName: istio-egressgateway-certs\n        - mountPath: /etc/istio/egressgateway-ca-certs\n          name: egressgateway-ca-certs\n          secretName: istio-egressgateway-ca-certs\n        type: ClusterIP\n      istio-ingressgateway:\n        autoscaleEnabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n        env: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        name: istio-ingressgateway\n        secretVolumes:\n        - mountPath: /etc/istio/ingressgateway-certs\n          name: ingressgateway-certs\n          secretName: istio-ingressgateway-certs\n        - mountPath: /etc/istio/ingressgateway-ca-certs\n          name: ingressgateway-ca-certs\n          secretName: istio-ingressgateway-ca-certs\n        type: LoadBalancer\n    global:\n      configValidation: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      defaultNodeSelector: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      defaultPodDisruptionBudget:\n        enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      defaultResources:\n        requests:\n          cpu: 10m\n      imagePullPolicy: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n      imagePullSecrets: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      istioNamespace: istio-system\n      istiod:\n        enableAnalysis: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      jwtPolicy: third-party-jwt\n      logAsJson: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      logging:\n        level: default:info\n      meshNetworks: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      mountMtlsCerts: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      multiCluster:\n        clusterName: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n        enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      network: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n      omitSidecarInjectorConfigMap: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      oneNamespace: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      operatorManageWebhooks: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      pilotCertProvider: istiod\n      priorityClassName: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n      proxy:\n        autoInject: enabled\n        clusterDomain: cluster.local\n        componentLogLevel: misc:error\n        enableCoreDump: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n        excludeIPRanges: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n        excludeInboundPorts: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n        excludeOutboundPorts: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n        image: proxyv2\n        includeIPRanges: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n        logLevel: warning\n        privileged: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n        readinessFailureThreshold: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("\n        readinessInitialDelaySeconds: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        readinessPeriodSeconds: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        resources:\n          limits:\n            cpu: 2000m\n            memory: 1024Mi\n          requests:\n            cpu: 10m\n            memory: 40Mi\n        statusPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15020")]),s._v("\n        tracer: zipkin\n      proxy_init:\n        image: proxyv2\n        resources:\n          limits:\n            cpu: 2000m\n            memory: 1024Mi\n          requests:\n            cpu: 10m\n            memory: 10Mi\n      sds:\n        token:\n          aud: istio-ca\n      sts:\n        servicePort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n      tracer:\n        datadog: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        lightstep: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        stackdriver: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        zipkin: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      useMCP: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    istiodRemote:\n      injectionURL: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    pilot:\n      autoscaleEnabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      autoscaleMax: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n      autoscaleMin: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      configMap: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      cpu:\n        targetAverageUtilization: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      enableProtocolSniffingForInbound: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      enableProtocolSniffingForOutbound: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      env: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      image: pilot\n      keepaliveMaxServerConnectionAge: 30m\n      nodeSelector: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      podLabels: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      replicaCount: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      traceSampling: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    telemetry:\n      enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n      v2:\n        enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n        metadataExchange:\n          wasmEnabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n        prometheus:\n          enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n          wasmEnabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n        stackdriver:\n          configOverride: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          enabled: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n          logging: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n          monitoring: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n          topology: "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br"),e("span",{staticClass:"line-number"},[s._v("138")]),e("br"),e("span",{staticClass:"line-number"},[s._v("139")]),e("br"),e("span",{staticClass:"line-number"},[s._v("140")]),e("br"),e("span",{staticClass:"line-number"},[s._v("141")]),e("br"),e("span",{staticClass:"line-number"},[s._v("142")]),e("br"),e("span",{staticClass:"line-number"},[s._v("143")]),e("br"),e("span",{staticClass:"line-number"},[s._v("144")]),e("br"),e("span",{staticClass:"line-number"},[s._v("145")]),e("br"),e("span",{staticClass:"line-number"},[s._v("146")]),e("br"),e("span",{staticClass:"line-number"},[s._v("147")]),e("br"),e("span",{staticClass:"line-number"},[s._v("148")]),e("br"),e("span",{staticClass:"line-number"},[s._v("149")]),e("br"),e("span",{staticClass:"line-number"},[s._v("150")]),e("br"),e("span",{staticClass:"line-number"},[s._v("151")]),e("br"),e("span",{staticClass:"line-number"},[s._v("152")]),e("br"),e("span",{staticClass:"line-number"},[s._v("153")]),e("br"),e("span",{staticClass:"line-number"},[s._v("154")]),e("br"),e("span",{staticClass:"line-number"},[s._v("155")]),e("br"),e("span",{staticClass:"line-number"},[s._v("156")]),e("br"),e("span",{staticClass:"line-number"},[s._v("157")]),e("br"),e("span",{staticClass:"line-number"},[s._v("158")]),e("br"),e("span",{staticClass:"line-number"},[s._v("159")]),e("br"),e("span",{staticClass:"line-number"},[s._v("160")]),e("br"),e("span",{staticClass:"line-number"},[s._v("161")]),e("br"),e("span",{staticClass:"line-number"},[s._v("162")]),e("br"),e("span",{staticClass:"line-number"},[s._v("163")]),e("br"),e("span",{staticClass:"line-number"},[s._v("164")]),e("br"),e("span",{staticClass:"line-number"},[s._v("165")]),e("br"),e("span",{staticClass:"line-number"},[s._v("166")]),e("br"),e("span",{staticClass:"line-number"},[s._v("167")]),e("br"),e("span",{staticClass:"line-number"},[s._v("168")]),e("br"),e("span",{staticClass:"line-number"},[s._v("169")]),e("br"),e("span",{staticClass:"line-number"},[s._v("170")]),e("br"),e("span",{staticClass:"line-number"},[s._v("171")]),e("br"),e("span",{staticClass:"line-number"},[s._v("172")]),e("br"),e("span",{staticClass:"line-number"},[s._v("173")]),e("br"),e("span",{staticClass:"line-number"},[s._v("174")]),e("br"),e("span",{staticClass:"line-number"},[s._v("175")]),e("br"),e("span",{staticClass:"line-number"},[s._v("176")]),e("br"),e("span",{staticClass:"line-number"},[s._v("177")]),e("br"),e("span",{staticClass:"line-number"},[s._v("178")]),e("br"),e("span",{staticClass:"line-number"},[s._v("179")]),e("br"),e("span",{staticClass:"line-number"},[s._v("180")]),e("br"),e("span",{staticClass:"line-number"},[s._v("181")]),e("br"),e("span",{staticClass:"line-number"},[s._v("182")]),e("br"),e("span",{staticClass:"line-number"},[s._v("183")]),e("br"),e("span",{staticClass:"line-number"},[s._v("184")]),e("br"),e("span",{staticClass:"line-number"},[s._v("185")]),e("br"),e("span",{staticClass:"line-number"},[s._v("186")]),e("br"),e("span",{staticClass:"line-number"},[s._v("187")]),e("br"),e("span",{staticClass:"line-number"},[s._v("188")]),e("br"),e("span",{staticClass:"line-number"},[s._v("189")]),e("br"),e("span",{staticClass:"line-number"},[s._v("190")]),e("br"),e("span",{staticClass:"line-number"},[s._v("191")]),e("br"),e("span",{staticClass:"line-number"},[s._v("192")]),e("br"),e("span",{staticClass:"line-number"},[s._v("193")]),e("br"),e("span",{staticClass:"line-number"},[s._v("194")]),e("br"),e("span",{staticClass:"line-number"},[s._v("195")]),e("br"),e("span",{staticClass:"line-number"},[s._v("196")]),e("br"),e("span",{staticClass:"line-number"},[s._v("197")]),e("br"),e("span",{staticClass:"line-number"},[s._v("198")]),e("br"),e("span",{staticClass:"line-number"},[s._v("199")]),e("br"),e("span",{staticClass:"line-number"},[s._v("200")]),e("br"),e("span",{staticClass:"line-number"},[s._v("201")]),e("br"),e("span",{staticClass:"line-number"},[s._v("202")]),e("br")])]),e("p",[s._v("编写配置清单文件istio-demo-config.yaml")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim istio-demo-config.yaml")]),s._v("\napiVersion: install.istio.io/v1alpha1\nkind: IstioOperator\nspec:\n  profile: demo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl install -f istio-demo-config.yaml")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("等待一段时间，完成安装：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl install -f istio-demo-config.yaml ")]),s._v("\nThis will "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" the Istio "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3 demo profile with "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Istio core"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Istiod"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ingress gateways"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Egress gateways"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" components into the cluster. Proceed? "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("y/N"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" y\n✔ Istio core installed                                                                                                             \n✔ Istiod installed                                                                                                                 \n✔ Ingress gateways installed                                                                                                       \n✔ Egress gateways installed                                                                                                        \n✔ Installation complete                                                                                                            Making this installation the default "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" injection and validation.\n\nThank you "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" installing Istio "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".  Please take a few minutes to tell us about your install/upgrade experience"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("  https://forms.gle/SWHFBmwJspusK1hv6\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl version")]),s._v("\nclient version: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3\ncontrol plane version: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3\ndata plane version: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.15")]),s._v(".3 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" proxies"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("blockquote",[e("p",[s._v("安装完成")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl -n istio-system get deploy")]),s._v("\nNAME                   READY   UP-TO-DATE   AVAILABLE   AGE\nistio-egressgateway    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           5h18m\nistio-ingressgateway   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           5h18m\nistiod                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           5h18m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl -n istio-system get pods")]),s._v("\nNAME                                   READY   STATUS    RESTARTS   AGE\nistio-egressgateway-df6f6d597-qjjrg    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5h19m\nistio-ingressgateway-577d9994f-8cbgm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5h19m\nistiod-64775594cd-x5mx6                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          5h19m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"_1-3-启用sidecar注入"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-启用sidecar注入"}},[s._v("#")]),s._v(" 1.3 启用sidecar注入")]),s._v(" "),e("p",[s._v("如果我们用 "),e("code",[s._v("istio-injection=enabled")]),s._v(" 标记命名空间，Istio 会自动为我们在该命名空间中创建的所有 Kubernetes Pod 注入 sidecar。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create ns microservice")]),s._v("\nnamespace/microservice created\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl label namespace microservice istio-injection=enabled")]),s._v("\nnamespace/microservice labeled\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("查看是否标记成功：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get namespace -L istio-injection")]),s._v("\nNAME               STATUS   AGE     ISTIO-INJECTION\ncalico-apiserver   Active   3d1h    \ncalico-system      Active   3d20h   \ndefault            Active   3d20h   \ndevops             Active   2d22h   \ngitlab             Active   3d      \nharbor             Active   3d1h    \ningress-nginx      Active   3d1h    \nistio-system       Active   9h      \nkube-node-lease    Active   3d20h   \nkube-public        Active   3d20h   \nkube-system        Active   3d20h   \nmicroservice       Active   37s     enabled\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get namespace -l istio-injection=enabled")]),s._v("\nNAME           STATUS   AGE\nmicroservice   Active   64s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("在"),e("code",[s._v("microservice")]),s._v("命名空间下，创建一个Deployment：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment mynginx --image=hub.c.163.com/library/nginx:latest -n microservice")]),s._v("\ndeployment.apps/mynginx created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("观察创建的pod：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n microservice")]),s._v("\nNAME                       READY   STATUS    RESTARTS   AGE\nmynginx-86cdf9b547-8vps4   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          42s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("这里，你会发现有两个容器，一个 "),e("code",[s._v("nginx")]),s._v(" 容器和一个 "),e("code",[s._v("istio-proxy")]),s._v(" 容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe pod mynginx-86cdf9b547-8vps4 -n microservice")]),s._v("\n Normal  Scheduled  85s   default-scheduler  Successfully assigned microservice/mynginx-86cdf9b547-8vps4 to node1\n  Normal  Pulled     84s   kubelet            Container image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker.io/istio/proxyv2:1.15.3"')]),s._v(" already present on machine\n  Normal  Created    84s   kubelet            Created container istio-init\n  Normal  Started    84s   kubelet            Started container istio-init\n  Normal  Pulling    83s   kubelet            Pulling image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hub.c.163.com/library/nginx:latest"')]),s._v("\n  Normal  Pulled     58s   kubelet            Successfully pulled image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hub.c.163.com/library/nginx:latest"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(".722633996s\n  Normal  Created    58s   kubelet            Created container nginx\n  Normal  Started    57s   kubelet            Started container nginx\n  Normal  Pulled     57s   kubelet            Container image "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker.io/istio/proxyv2:1.15.3"')]),s._v(" already present on machine\n  Normal  Created    57s   kubelet            Created container istio-proxy\n  Normal  Started    57s   kubelet            Started container istio-proxy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("删除后，其都会删除")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete deployment mynginx -n microservice ")]),s._v("\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mynginx"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n microservice")]),s._v("\nNo resources found "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" microservice namespace.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h2",{attrs:{id:"_2-实例应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-实例应用"}},[s._v("#")]),s._v(" 2. 实例应用")]),s._v(" "),e("p",[s._v("使用github的这个实例应用：https://github.com/GoogleCloudPlatform/microservices-demo")]),s._v(" "),e("p",[s._v("在线地址：https://onlineboutique.dev/")]),s._v(" "),e("p",[s._v("这是一个云原生微服务架构的商城示例项目。")]),s._v(" "),e("p",[e("img",{attrs:{src:"img/image-20221104212453668.png",alt:"image-20221104212453668"}})]),s._v(" "),e("p",[s._v("由 11 个用不同语言编写的微服务组成，服务间通过 gRPC 相互通信。")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[s._v("服务")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("语言")]),s._v(" "),e("th",{staticStyle:{"text-align":"left"}},[s._v("说明")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("frontend")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Go")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("提供一个 HTTP 服务。实现不需要注册/登录并自动为所有用户生成会话 ID")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("cartservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("C#")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("将用户购物车中的商品存储在 Redis 中并进行检索")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("productcatalogservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Go")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("产品列表（来自 JSON 文件）、搜索产品以及获取单个产品")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("currencyservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Node.js")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("将一种货币金额转换为另一种货币。 使用从欧洲中央银行获取的真实值。 这是最高的 QPS 服务")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("paymentservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Node.js")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("用给定的金额向给定的信用卡信息（模拟）收取费用并返回交易 ID")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("shippingservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Go")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("根据购物车提供运费估算。 将物品运送到给定地址（模拟）")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("emailservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Python")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("向用户发送订单确认电子邮件（模拟）")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("checkoutservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Go")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("检索用户购物车、准备订单并协调付款、运输和电子邮件通知")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("recommendationservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Python")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("根据购物车中给出的内容推荐其他产品")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("adservice")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Java")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("根据给定的上下文词提供文字广告")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[s._v("loadgenerator")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("Python/Locust")]),s._v(" "),e("td",{staticStyle:{"text-align":"left"}},[s._v("不断向前端发送模仿真实用户购物流程的请求")])])])]),s._v(" "),e("p",[s._v("下载部署文件，进行k8s部署：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://raw.githubusercontent.com/GoogleCloudPlatform/microservices-demo/main/release/kubernetes-manifests.yaml")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),s._v("\n-rw-r--r-- "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("423389")]),s._v(" Nov  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 09:29 kubernetes-manifests.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create ns microservices-demo")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -n microservices-demo -f kubernetes-manifests.yaml")]),s._v("\ndeployment.apps/emailservice created\nservice/emailservice created\ndeployment.apps/checkoutservice created\nservice/checkoutservice created\ndeployment.apps/recommendationservice created\nservice/recommendationservice created\ndeployment.apps/frontend created\nservice/frontend created\nservice/frontend-external created\ndeployment.apps/paymentservice created\nservice/paymentservice created\ndeployment.apps/productcatalogservice created\nservice/productcatalogservice created\ndeployment.apps/cartservice created\nservice/cartservice created\ndeployment.apps/loadgenerator created\ndeployment.apps/currencyservice created\nservice/currencyservice created\ndeployment.apps/shippingservice created\nservice/shippingservice created\ndeployment.apps/redis-cart created\nservice/redis-cart created\ndeployment.apps/adservice created\nservice/adservice created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n microservices-demo")]),s._v("\nNAME                                     READY   STATUS    RESTARTS   AGE\nadservice-6fbf9d7bb5-hl2lk               "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\ncartservice-85b7fbf97c-p4pkt             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\ncheckoutservice-c59c64549-7dhkn          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\ncurrencyservice-9c56df89f-xw9ln          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nemailservice-94d448b97-96fvs             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nfrontend-5cd6fb7c77-zxhll                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nloadgenerator-c46f99f5f-8g7wz            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\npaymentservice-654b4b98d9-smps4          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nproductcatalogservice-697c6cd9c7-mqtg4   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nrecommendationservice-685b8b7c79-m7pmm   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nredis-cart-799c85c644-pqt5v              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\nshippingservice-d7495c9f-9smnj           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14m\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n microservices-demo   ")]),s._v("\nNAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nadservice               ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".135.191    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9555")]),s._v("/TCP       36s\ncartservice             ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),s._v(".27.83      "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7070")]),s._v("/TCP       36s\ncheckoutservice         ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),s._v(".236.38     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5050")]),s._v("/TCP       36s\ncurrencyservice         ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.103")]),s._v(".7.4       "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("7000")]),s._v("/TCP       36s\nemailservice            ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.106")]),s._v(".218.15    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("/TCP       36s\nfrontend                ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.107")]),s._v(".175.199   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP         36s\nfrontend-external       LoadBalancer   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.105")]),s._v(".175.139   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pending"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32671/TCP   36s\npaymentservice          ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".28.210    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50051")]),s._v("/TCP      36s\nproductcatalogservice   ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".255.58    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3550")]),s._v("/TCP       36s\nrecommendationservice   ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),s._v(".9.169     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/TCP       36s\nredis-cart              ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.111")]),s._v(".152.83    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/TCP       36s\nshippingservice         ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.98")]),s._v(".18.33      "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50051")]),s._v("/TCP      36s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br")])]),e("p",[s._v("等待所有的pod启动完成，然后通过frontend-external的svc进行访问")]),s._v(" "),e("p",[e("img",{attrs:{src:"img/image-20221104214648113.png",alt:"image-20221104214648113"}})]),s._v(" "),e("h3",{attrs:{id:"_2-1-启用istio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-启用istio"}},[s._v("#")]),s._v(" 2.1 启用Istio")]),s._v(" "),e("p",[s._v("将上述微服务升级为服务网格架构，为微服务启用 Istio 支持。")]),s._v(" "),e("p",[s._v("要启用 Istio 支持，只要为 POD 额外注入一个 SideCar 应用。")]),s._v(" "),e("p",[s._v("我们在上面给命名空间"),e("code",[s._v("microservice")]),s._v("添加了label "),e("code",[s._v("istio-injection=enabled")]),s._v("，所以当我们将pod运行在microservice命名空间下时，就会自动注入sidecar。")]),s._v(" "),e("p",[s._v("将上述的服务删除，重新将其部署在microservice命名空间下")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete -n microservices-demo -f kubernetes-manifests.yaml     ")]),s._v("\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"emailservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"emailservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"checkoutservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"checkoutservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"recommendationservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"recommendationservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"frontend"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"frontend"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"frontend-external"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paymentservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"paymentservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"productcatalogservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"productcatalogservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cartservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cartservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"loadgenerator"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"currencyservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"currencyservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shippingservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"shippingservice"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-cart"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis-cart"')]),s._v(" deleted\ndeployment.apps "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"adservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"adservice"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -n microservice -f kubernetes-manifests.yaml            ")]),s._v("\ndeployment.apps/emailservice created\nservice/emailservice created\ndeployment.apps/checkoutservice created\nservice/checkoutservice created\ndeployment.apps/recommendationservice created\nservice/recommendationservice created\ndeployment.apps/frontend created\nservice/frontend created\nservice/frontend-external created\ndeployment.apps/paymentservice created\nservice/paymentservice created\ndeployment.apps/productcatalogservice created\nservice/productcatalogservice created\ndeployment.apps/cartservice created\nservice/cartservice created\ndeployment.apps/loadgenerator created\ndeployment.apps/currencyservice created\nservice/currencyservice created\ndeployment.apps/shippingservice created\nservice/shippingservice created\ndeployment.apps/redis-cart created\nservice/redis-cart created\ndeployment.apps/adservice created\nservice/adservice created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br")])]),e("p",[s._v("和之前不同的是，我们应该使用 Istio 的入口网关来访问应用，不再需要 "),e("code",[s._v("frontend-external")]),s._v(" 服务了。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete svc frontend-external -n microservice")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"frontend-external"')]),s._v(" deleted\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system")]),s._v("\nNAME                   TYPE           CLUSTER-IP      EXTERNAL-IP   PORT"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\nistio-egressgateway    ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.111")]),s._v(".99.6     "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP,443/TCP                                                               10h\nistio-ingressgateway   LoadBalancer   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.97")]),s._v(".199.159   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pending"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v(":32040/TCP,80:32376/TCP,443:30965/TCP,31400:31694/TCP,15443:31464/TCP   10h\nistiod                 ClusterIP      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.99")]),s._v(".214.71    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15010")]),s._v("/TCP,15012/TCP,443/TCP,15014/TCP \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("需要为 Istio 声明一些配置，让其可以正确路由到 Online Boutique 应用：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://raw.githubusercontent.com/GoogleCloudPlatform/microservices-demo/main/release/istio-manifests.yaml")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master microservice-demo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -n microservice -f istio-manifests.yaml ")]),s._v("\ngateway.networking.istio.io/frontend-gateway created\nvirtualservice.networking.istio.io/frontend-ingress created\nserviceentry.networking.istio.io/allow-egress-googleapis created\nserviceentry.networking.istio.io/allow-egress-google-metadata created\nvirtualservice.networking.istio.io/frontend created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[e("img",{attrs:{src:"img/image-20221104220344972.png",alt:"image-20221104220344972"}})]),s._v(" "),e("p",[s._v("访问效果是一样的，只不过是通过istio访问的。")])])}),[],!1,null,null,null);e.default=a.exports}}]);