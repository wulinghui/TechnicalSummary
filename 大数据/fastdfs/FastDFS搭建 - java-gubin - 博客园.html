<!DOCTYPE html>
<!-- saved from url=(0046)https://www.cnblogs.com/gu-bin/p/10918552.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="referrer" content="origin">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <title>FastDFS搭建 - java-gubin - 博客园</title>
    <meta property="og:description" content="目录 一、FastDFS介绍 1、简介 2、FastDFS的存储策略 3、FastDFS的上传过程 4、FastDFS的文件同步 5、FastDFS的文件下载 二、安装FastDFS环境 0、前言 1">
    <link type="text/css" rel="stylesheet" href="./FastDFS搭建 - java-gubin - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./FastDFS搭建 - java-gubin - 博客园_files/bundle-CodingLife.css">
<link type="text/css" rel="stylesheet" href="./FastDFS搭建 - java-gubin - 博客园_files/466167.css">
<link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./FastDFS搭建 - java-gubin - 博客园_files/bundle-CodingLife-mobile.css">
    <link title="RSS" type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/gu-bin/rss">
    <link title="RSD" type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/gu-bin/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/gu-bin/wlwmanifest.xml">
    <script async="" src="./FastDFS搭建 - java-gubin - 博客园_files/analytics.js.下载"></script><script type="text/javascript" src="./FastDFS搭建 - java-gubin - 博客园_files/encoder.js.下载"></script><script src="./FastDFS搭建 - java-gubin - 博客园_files/jquery-2.2.0.min.js.下载"></script>
    <script>var currentBlogId=466167;var currentBlogApp='gu-bin',cb_enable_mathjax=false;var isLogined=false;</script>
    <script src="./FastDFS搭建 - java-gubin - 博客园_files/blog-common.js.下载" type="text/javascript"></script>
<link rel="preload" href="./FastDFS搭建 - java-gubin - 博客园_files/f.txt" as="script"><script type="text/javascript" src="./FastDFS搭建 - java-gubin - 博客园_files/f.txt"></script><link rel="preload" href="./FastDFS搭建 - java-gubin - 博客园_files/f(1).txt" as="script"><script type="text/javascript" src="./FastDFS搭建 - java-gubin - 博客园_files/f(1).txt"></script><script src="./FastDFS搭建 - java-gubin - 博客园_files/pubads_impl_2019053001.js.下载" async=""></script></head>
<body>
<a name="top"></a>

<!--PageBeginHtml Block Begin-->
<a href="https://gitee.com/gubin0412">  
<img style="position: absolute; top: 0; right: 0; border: 0" src="./FastDFS搭建 - java-gubin - 博客园_files/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png">
</a>
<!--PageBeginHtml Block End-->

<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
	<a id="lnkBlogLogo" href="https://www.cnblogs.com/gu-bin/"><img id="blogLogo" src="./FastDFS搭建 - java-gubin - 博客园_files/logo.gif" alt="返回主页"></a>			
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="https://www.cnblogs.com/gu-bin/">古斌的小窝</a></h1>
<h2>一个喜欢编程的小码农</h2>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">博客园</a></li>
<li><a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/gu-bin/">首页</a></li>
<li><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/java-gubin">联系</a></li>
<li><a id="blog_nav_rss" class="menu" href="https://www.cnblogs.com/gu-bin/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="https://www.cnblogs.com/gu-bin/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>
		<div class="blogStats">
			
			<div id="blog_stats">
<span id="stats_post_count">随笔 - 110&nbsp; </span>
<span id="stats_article_count">文章 - 0&nbsp; </span>
<span id="stats-comment_count">评论 - 3</span>
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->

<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
        <div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="https://www.cnblogs.com/gu-bin/p/10918552.html">FastDFS搭建</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body" class="blogpost-body"><div id="navCategory" style="color: #152e97;">
<p style="font-size: 18px;"><strong>目录</strong></p>
<ul>
<li>&nbsp;一、FastDFS介绍
<ul>
<li>1、简介</li>
<li>2、FastDFS的存储策略</li>
<li>3、FastDFS的上传过程</li>
<li>4、FastDFS的文件同步</li>
<li>5、FastDFS的文件下载</li>
</ul>
</li>
<li>二、安装FastDFS环境
<ul>
<li>0、前言</li>
<li>1、下载安装 libfastcommon</li>
<li>2、下载安装FastDFS</li>
<li>3、配置FastDFS跟踪器(Tracker)</li>
<li>4、配置 FastDFS 存储 (Storage)</li>
<li>5、文件上传测试</li>
</ul>
</li>
<li>三、安装Nginx
<ul>
<li>1、安装nginx所需环境　　</li>
<li>2、安装Nginx</li>
<li>3、访问文件</li>
</ul>
</li>
<li>四、FastDFS 配置 Nginx 模块
<ul>
<li>1、安装配置Nginx模块</li>
</ul>
</li>
<li>五、Java客户端
<ul>
<li>1、首先需要搭建 FastDFS 客户端Java开发环境</li>
<li>2、客户端API</li>
<li>六、权限控制
<ul>
<li>我的QQ 2955274788 有问题欢迎联系 来着备注</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>&nbsp;</p>
<hr style="height: 1px; border: none; border-top: 1px dashed #0066CC;">
<div style="text-align: right;"><a style="color: #f68a33;" href="https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop">回到顶部</a><a name="_label0"></a></div>
<h2>&nbsp;一、FastDFS介绍</h2>
<p>FastDFS开源地址：<a href="https://github.com/happyfish100" target="_blank">https://github.com/happyfish100</a></p>
<p>参考：<a href="http://blog.chinaunix.net/uid-20196318-id-4058561.html" target="_blank">分布式文件系统FastDFS设计原理</a>&nbsp;</p>
<p>参考：<a id="cb_post_title_url" class="singleposttitle" href="http://www.cnblogs.com/Leo_wl/p/6731647.html" target="_blank">FastDFS分布式文件系统</a></p>
<p>个人封装的FastDFS Java API：<a href="https://github.com/bojiangzhou/lyyzoo-fastdfs-java" target="_blank">https://github.com/bojiangzhou/lyyzoo-fastdfs-java</a></p>
<p><a name="_label0_0"></a></p>
<h3>1、简介</h3>
<p>FastDFS 是一个开源的高性能分布式文件系统（DFS）。 它的主要功能包括：文件存储，文件同步和文件访问，以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB &lt; file_size &lt;500MB）为载体的在线服务。</p>
<p>FastDFS 系统有三个角色：跟踪服务器(Tracker Server)、存储服务器(Storage Server)和客户端(Client)。</p>
<p><strong>　　Tracker Server</strong>：跟踪服务器，主要做调度工作，起到均衡的作用；负责管理所有的 storage server和 group，每个 storage 在启动后会连接 Tracker，告知自己所属 group 等信息，并保持周期性心跳。</p>
<p><strong>　　Storage Server</strong>：存储服务器，主要提供容量和备份服务；以 group 为单位，每个 group 内可以有多台 storage server，数据互为备份。</p>
<p><strong>　　Client</strong>：客户端，上传下载数据的服务器，也就是我们自己的项目所部署在的服务器。</p>
<p>&nbsp;<img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011144153840-1185141903.png" alt=""></p>
<p><a name="_label0_1"></a></p>
<h3><strong>2、FastDFS的存储策略</strong></h3>
<p>为了支持大容量，存储节点（服务器）采用了分卷（或分组）的组织方式。存储系统由一个或多个卷组成，卷与卷之间的文件是相互独立的，所有卷的文件容量累加就是整个存储系统中的文件容量。一个卷可以由一台或多台存储服务器组成，一个卷下的存储服务器中的文件都是相同的，卷中的多台存储服务器起到了冗余备份和负载均衡的作用。</p>
<p>在卷中增加服务器时，同步已有的文件由系统自动完成，同步完成后，系统自动将新增服务器切换到线上提供服务。当存储空间不足或即将耗尽时，可以动态添加卷。只需要增加一台或多台服务器，并将它们配置为一个新的卷，这样就扩大了存储系统的容量。</p>
<p><a name="_label0_2"></a></p>
<h3><strong>3、FastDFS的上传过程</strong></h3>
<p>FastDFS向使用者提供基本文件访问接口，比如upload、download、append、delete等，以客户端库的方式提供给用户使用。</p>
<p>Storage Server会定期的向Tracker Server发送自己的存储信息。当Tracker Server Cluster中的Tracker Server不止一个时，各个Tracker之间的关系是对等的，所以客户端上传时可以选择任意一个Tracker。</p>
<p>当Tracker收到客户端上传文件的请求时，会为该文件分配一个可以存储文件的group，当选定了group后就要决定给客户端分配group中的哪一个storage server。当分配好storage server后，客户端向storage发送写文件请求，storage将会为文件分配一个数据存储目录。然后为文件分配一个fileid，最后根据以上的信息生成文件名存储文件。</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171012121639387-1574147926.png" alt=""></p>
<p><a name="_label0_3"></a></p>
<h3><strong>4、FastDFS的文件同步</strong></h3>
<p>写文件时，客户端将文件写至group内一个storage server即认为写文件成功，storage server写完文件后，会由后台线程将文件同步至同group内其他的storage server。</p>
<p>每个storage写文件后，同时会写一份binlog，binlog里不包含文件数据，只包含文件名等元信息，这份binlog用于后台同步，storage会记录向group内其他storage同步的进度，以便重启后能接上次的进度继续同步；进度以时间戳的方式进行记录，所以最好能保证集群内所有server的时钟保持同步。</p>
<p>storage的同步进度会作为元数据的一部分汇报到tracker上，tracke在选择读storage的时候会以同步进度作为参考。</p>
<p><a name="_label0_4"></a></p>
<h3><strong>5、FastDFS的文件下载</strong></h3>
<p>客户端uploadfile成功后，会拿到一个storage生成的文件名，接下来客户端根据这个文件名即可访问到该文件。</p>
<p><img style="border: 1px solid black;" src="./FastDFS搭建 - java-gubin - 博客园_files/380252-20170415090611017-204910775.png" alt=""></p>
<p>跟upload file一样，在downloadfile时客户端可以选择任意tracker server。tracker发送download请求给某个tracker，必须带上文件名信息，tracke从文件名中解析出文件的group、大小、创建时间等信息，然后为该请求选择一个storage用来服务读请求。</p>
<p>&nbsp;</p>
<div style="text-align: right;"><a style="color: #f68a33;" href="https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop">回到顶部</a><a name="_label1"></a></div>
<h2>二、安装FastDFS环境</h2>
<p><a name="_label1_0"></a></p>
<h3>0、前言</h3>
<p>操作环境：CentOS7 X64，以下操作都是单机环境。</p>
<p>我把所有的安装包下载到/softpackages/下，解压到当前目录。</p>
<p>先做一件事，修改hosts，将文件服务器的ip与域名映射(单机TrackerServer环境)，因为后面很多配置里面都需要去配置服务器地址，ip变了，就只需要修改hosts即可。</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># vim /etc/hosts

增加如下一行，这是我的IP
192.168.51.128 file.ljzsg.com

如果要本机访问虚拟机，在C:\Windows\System32\drivers\etc\hosts中同样增加一行</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><a name="_label1_1"></a></p>
<h3>1、下载安装 libfastcommon</h3>
<p><span class="fontstyle0">libfastcommon是从 FastDFS 和 FastDHT 中提取出来的公共 C 函数库，基础环境，安装即可 。<br></span></p>
<p>① 下载libfastcommon</p>
<div class="cnblogs_code">
<pre># wget https://github.com/happyfish100/libfastcommon/archive/V1.0.7.tar.gz</pre>
</div>
<p>② 解压</p>
<div class="cnblogs_code">
<pre># tar -zxvf V1.0.7.tar.gz
# cd libfastcommon-1.0.7</pre>
</div>
<p>③ 编译、安装</p>
<div class="cnblogs_code">
<pre># ./make.sh
# ./make.sh install</pre>
</div>
<p>④&nbsp;libfastcommon.so 安装到了/usr/lib64/libfastcommon.so，但是FastDFS主程序设置的lib目录是/usr/local/lib，所以需要创建软链接。</p>
<div class="cnblogs_code">
<pre># ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so
# ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so
# ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so
# ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so </pre>
</div>
<p><a name="_label1_2"></a></p>
<h3>2、下载安装FastDFS</h3>
<p>① 下载FastDFS</p>
<div class="cnblogs_code">
<pre># wget https://github.com/happyfish100/fastdfs/archive/V5.05.tar.gz</pre>
</div>
<p>② 解压</p>
<div class="cnblogs_code">
<pre># tar -zxvf V5.05.tar.gz
# cd fastdfs-5.05</pre>
</div>
<p>③ 编译、安装</p>
<div class="cnblogs_code">
<pre># ./make.sh
# ./make.sh install</pre>
</div>
<p><span class="fontstyle0"><span class="fontstyle0">④ 默认安装方式安装后的相应文件与目录<br>　　A、服务脚本：</span></span></p>
<div class="cnblogs_code">
<pre>/etc/init.d/fdfs_storaged
/etc/init.d/fdfs_tracker</pre>
</div>
<p><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0">　　B、配置文件（这三个是作者给的样例配置文件） :<br></span></span></span></span></p>
<div class="cnblogs_code">
<pre>/etc/fdfs/client.conf.sample
/etc/fdfs/storage.conf.sample
/etc/fdfs/tracker.conf.sample</pre>
</div>
<p><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0">　　C、命令工具在 /usr/bin/ 目录下：<span class="fontstyle0"><br></span></span></span></span></span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>fdfs_appender_test
fdfs_appender_test1
fdfs_append_file
fdfs_crc32
fdfs_delete_file
fdfs_download_file
fdfs_file_info
fdfs_monitor
fdfs_storaged
fdfs_test
fdfs_test1
fdfs_trackerd
fdfs_upload_appender
fdfs_upload_file
stop.sh
restart.sh </pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑤&nbsp;<span class="fontstyle0">FastDFS 服务脚本设置的 bin 目录是 /usr/local/bin， 但实际命令安装在 /usr/bin/ 下。</span></p>
<p><span class="fontstyle0">　　两种方式：</span></p>
<p><span class="fontstyle0">　　》 一是修改<span class="fontstyle0">FastDFS 服务脚本中相应的命令路径，也就是把&nbsp;<span class="fontstyle0">/etc/init.d/fdfs_storaged&nbsp;<span class="fontstyle0">和&nbsp;<span class="fontstyle0">/etc/init.d/fdfs_tracker <span class="fontstyle0">两个脚本中的&nbsp;<span class="fontstyle0">/usr/local/bin <span class="fontstyle0">修改成&nbsp;<span class="fontstyle0">/usr/bin。<br></span></span></span></span></span></span></span></span></span></p>
<p>&nbsp;　　　　<span class="fontstyle0"># <span class="fontstyle0">vim fdfs_trackerd<br><span class="fontstyle0">　　　　使用查找替换命令进统一修改:<span class="fontstyle0">%s+/usr/local/bin+/usr/bin<br><span class="fontstyle0">　　　　# <span class="fontstyle0">vim fdfs_storaged<br><span class="fontstyle0">　　　　使用查找替换命令进统一修改:<span class="fontstyle0">%s+/usr/local/bin+/usr/bin </span></span></span></span></span></span></span></span></p>
<p><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0">　　　　<img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011104718043-576731412.png" alt="" width="452" height="140"></span></span></span></span></span></span></span></span></p>
<p>　　》 二是建立 /usr/bin 到 /usr/local/bin 的软链接，我是用这种方式。　　</p>
<div class="cnblogs_code">
<pre># ln -s /usr/bin/fdfs_trackerd   /usr/local/bin
# ln -s /usr/bin/fdfs_storaged   /usr/local/bin
# ln -s /usr/bin/stop.sh         /usr/local/bin
# ln -s /usr/bin/restart.sh      /usr/local/bin</pre>
</div>
<p><a name="_label1_3"></a></p>
<h3>3、配置FastDFS跟踪器(Tracker)</h3>
<p>配置文件详细说明参考：<a id="thread_subject" href="http://bbs.chinaunix.net/forum.php?mod=viewthread&amp;tid=1941456&amp;extra=page%3D1%26filter%3Ddigest%26digest%3D1" target="_blank">FastDFS 配置文件详解</a></p>
<p>① 进入 /etc/fdfs，复制 FastDFS 跟踪器样例配置文件 tracker.conf.sample，并重命名为 tracker.conf。</p>
<div class="cnblogs_code">
<pre># cd /etc/fdfs
# cp tracker.conf.sample tracker.conf
# vim tracker.conf</pre>
</div>
<p>② 编辑<span class="fontstyle0">tracker.conf ，标红的需要修改下，其它的默认即可。<br></span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># 配置文件是否不生效，false 为生效
disabled=false<br>
# 提供服务的端口
port=22122<br>
# Tracker 数据和日志目录地址(根目录必须存在,子目录会自动创建)
<span style="color: #ff0000;">base_path=/ljzsg/fastdfs/tracker<br>
# HTTP 服务端口
<span style="color: #ff0000;">http.server_port=80</span></span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>③ 创建tracker基础数据目录，即base_path对应的目录</p>
<div class="cnblogs_code">
<pre># mkdir -p /ljzsg/fastdfs/tracker</pre>
</div>
<p>④ 防火墙中打开跟踪端口（默认的22122）</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># vim /etc/sysconfig/iptables<br>
添加如下端口行：
-A INPUT -m state --state NEW -m tcp -p tcp --dport 22122 -j ACCEPT<br>
重启防火墙：
# service iptables restart</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑤ 启动Tracker</p>
<p>初次成功启动，会在 /ljzsg/fdfsdfs/tracker/ (配置的base_path)下创建 data、logs 两个目录。</p>
<div class="cnblogs_code">
<pre>可以用这种方式启动
# /etc/init.d/fdfs_trackerd start

也可以用这种方式启动，前提是上面创建了软链接，后面都用这种方式
# service fdfs_trackerd start</pre>
</div>
<p><span class="fontstyle0">查看 FastDFS Tracker 是否已成功启动 ，22122端口正在被监听，则算是Tracker服务安装成功。<br></span></p>
<div class="cnblogs_code">
<pre># netstat -unltp|grep fdfs</pre>
</div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011121344184-1089101646.png" alt=""></p>
<p>关闭Tracker命令：</p>
<div class="cnblogs_code">
<pre># service fdfs_trackerd stop</pre>
</div>
<p>⑥ 设置Tracker开机启动</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># chkconfig fdfs_trackerd on<br><br>或者：<br># vim /etc/rc.d/rc.local<br>加入配置：<br>/etc/init.d/fdfs_trackerd start </pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑦&nbsp;<span class="fontstyle0">tracker server <span class="fontstyle2">目录及文件结构 <br></span></span></p>
<p>Tracker服务启动成功后，会在base_path下创建data、logs两个目录。目录结构如下：</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>${base_path}
  |__data
  |   |__storage_groups.dat：存储分组信息
  |   |__storage_servers.dat：存储服务器列表
  |__logs
  |   |__trackerd.log： tracker server 日志文件 </pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><a name="_label1_4"></a></p>
<h3>4、<span class="fontstyle0">配置 FastDFS 存储 (Storage)</span></h3>
<p><span class="fontstyle0">① 进入 /etc/fdfs 目录，<span class="fontstyle0">复制 FastDFS 存储器样例配置文件 storage.conf.sample，并重命名为 storage.conf</span></span></p>
<div class="cnblogs_code">
<pre># cd /etc/fdfs
# cp storage.conf.sample storage.conf<br># vim storage.conf</pre>
</div>
<p>② 编辑storage.conf</p>
<p>标红的需要修改，其它的默认即可。</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># 配置文件是否不生效，false 为生效
disabled=false 

# 指定此 storage server 所在 组(卷)
group_name=group1

# storage server 服务端口
port=23000

# 心跳间隔时间，单位为秒 (这里是指主动向 tracker server 发送心跳)
heart_beat_interval=30

# Storage 数据和日志目录地址(根目录必须存在，子目录会自动生成)
<span style="color: #ff0000;">base_path=/ljzsg/fastdfs/storage

# 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录。
store_path_count=1


# 逐一配置 store_path_count 个路径，索引号基于 0。
# 如果不配置 store_path0，那它就和 base_path 对应的路径一样。
<span style="color: #ff0000;">store_path0=/ljzsg/fastdfs/file

# FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。 
# 如果本参数只为 N（如： 256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N * N 个存放文件的子目录。
subdir_count_per_path=256

# tracker_server 的列表 ，会主动连接 tracker_server
# 有多个 tracker server 时，每个 tracker server 写一行
<span style="color: #ff0000;">tracker_server=file.ljzsg.com:22122<br><br># 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定。<br><span class="fontstyle0">sync_start_time=00:00<br><span class="fontstyle0">sync_end_time=23:59</span></span></span></span></span></pre>
<pre># 访问端口<br><span style="color: #ff0000;">http.server_port=80</span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>③ 创建Storage基础数据目录，对应base_path目录</p>
<div class="cnblogs_code">
<pre># mkdir -p /ljzsg/fastdfs/storage

# 这是配置的store_path0路径
# mkdir -p /ljzsg/fastdfs/file</pre>
</div>
<p>④&nbsp;<span class="fontstyle0">防火墙中打开存储器端口（默认的 23000） <br></span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># vim /etc/sysconfig/iptables

添加如下端口行：
-A INPUT -m state --state NEW -m tcp -p tcp --dport 23000 -j ACCEPT

重启防火墙：
# service iptables restart</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011133233777-1903096242.png" alt=""></p>
<p>⑤ 启动 Storage</p>
<p><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0">启动Storage前确保Tracker是启动的。初次启动成功，会在 /ljzsg/fastdfs/storage 目录下创建 data、 logs 两个目录。<br></span></span></span></p>
<div class="cnblogs_code">
<pre>可以用这种方式启动
# /etc/init.d/fdfs_storaged start

也可以用这种方式，后面都用这种
# service fdfs_storaged start</pre>
</div>
<p>查看 Storage 是否成功启动，23000 端口正在被监听，就算 Storage 启动成功。</p>
<div class="cnblogs_code">
<pre># netstat -unltp|grep fdfs</pre>
</div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011134723387-604894314.png" alt=""></p>
<p>关闭Storage命令：</p>
<div class="cnblogs_code">
<pre># service fdfs_storaged stop</pre>
</div>
<p>查看Storage和Tracker是否在通信：</p>
<div class="cnblogs_code">
<pre>/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</pre>
</div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171016093815615-757608481.png" alt="" width="693" height="420"></p>
<p>⑥ 设置 Storage 开机启动</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># chkconfig fdfs_storaged on<br><br></pre>
<pre>或者：<br># vim /etc/rc.d/rc.local<br>加入配置：<br>/etc/init.d/fdfs_storaged start</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑦ Storage 目录</p>
<p>同 Tracker，Storage 启动成功后，在base_path 下创建了data、logs目录，记录着 Storage Server 的信息。</p>
<p>在 store_path0 目录下，创建了N*N个子目录：</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011135658074-1715166829.png" alt=""></p>
<p><a name="_label1_5"></a></p>
<h3>5、文件上传测试</h3>
<p>① 修改 Tracker&nbsp;<span class="fontstyle0">服务器中的客户端配置文件&nbsp;</span></p>
<div class="cnblogs_code">
<pre># cd /etc/fdfs
# cp client.conf.sample client.conf
# vim client.conf</pre>
</div>
<p>修改如下配置即可，其它默认。</p>
<div class="cnblogs_code">
<pre># Client 的数据和日志目录
<span style="color: #ff0000;">base_path=/ljzsg/fastdfs/client

# Tracker端口
<span style="color: #ff0000;">tracker_server=file.ljzsg.com:22122</span></span></pre>
</div>
<p>② 上传测试</p>
<p>&nbsp;在linux内部执行如下命令上传 namei.jpeg 图片</p>
<div class="cnblogs_code">
<pre># /usr/bin/fdfs_upload_file /etc/fdfs/client.conf namei.jpeg</pre>
</div>
<p>上传成功后返回文件ID号：group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011142634105-1857091563.png" alt=""></p>
<p>返回的文件ID由<span class="kwd">group<span class="pun">、存储目录、两级子目录、<span class="pln">fileid<span class="pun">、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。</span></span></span></span></p>
<p><img style="border: 1px solid black;" src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011151728965-914197096.png" alt=""></p>
<p>&nbsp;</p>
<div style="text-align: right;"><a style="color: #f68a33;" href="https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop">回到顶部</a><a name="_label2"></a></div>
<h2>三、安装Nginx</h2>
<p>上面将文件上传成功了，但我们无法下载。因此安装Nginx作为服务器以支持Http方式访问文件。同时，后面安装FastDFS的Nginx模块也需要Nginx环境。</p>
<p>Nginx只需要安装到StorageServer所在的服务器即可，用于访问文件。我这里由于是单机，TrackerServer和StorageServer在一台服务器上。</p>
<p><a name="_label2_0"></a></p>
<h3>1、安装nginx所需环境　　</h3>
<p>①&nbsp;gcc 安装</p>
<div class="cnblogs_code">
<pre># yum install gcc-c++</pre>
</div>
<p>②&nbsp;PCRE pcre-devel 安装</p>
<div class="cnblogs_code">
<pre># yum install -y pcre pcre-devel</pre>
</div>
<p>③&nbsp;zlib 安装</p>
<div class="cnblogs_code">
<pre># yum install -y zlib zlib-devel</pre>
</div>
<p>④&nbsp;OpenSSL 安装</p>
<div class="cnblogs_code">
<pre># yum install -y openssl openssl-devel</pre>
</div>
<p><a name="_label2_1"></a></p>
<h3>2、安装Nginx</h3>
<p>① 下载nginx</p>
<div class="cnblogs_code">
<pre># wget -c https://nginx.org/download/nginx-1.12.1.tar.gz</pre>
</div>
<p>② 解压</p>
<div class="cnblogs_code">
<pre># tar -zxvf nginx-1.12.1.tar.gz
# cd nginx-1.12.1</pre>
</div>
<p>③ 使用默认配置</p>
<div class="cnblogs_code">
<pre># ./configure</pre>
</div>
<p>④ 编译、安装</p>
<div class="cnblogs_code">
<pre># make
# make install</pre>
</div>
<p>⑤ 启动nginx</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># cd /usr/local/nginx/sbin/
# ./nginx 

其它命令
# ./nginx -s stop
# ./nginx -s quit
# ./nginx -s reload</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑥ 设置开机启动</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># vim /etc/rc.local

添加一行：
/usr/local/nginx/sbin/nginx<br><br># 设置执行权限<br># <span class="hljs-keyword">chmod <span class="hljs-number">755 rc.<span class="hljs-keyword">local</span></span></span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑦ 查看nginx的版本及模块</p>
<div class="cnblogs_code">
<pre>/usr/local/nginx/sbin/nginx -V</pre>
</div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011165300730-1693050013.png" alt=""></p>
<p>⑧&nbsp;<span class="fontstyle0">防火墙中打开Nginx端口（默认的 80）&nbsp;<br></span></p>
<p><span class="fontstyle0">添加后就能在本机使用80端口访问了。</span></p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># vim /etc/sysconfig/iptables

添加如下端口行：
-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT

重启防火墙：
# service iptables restart</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011172121746-2118138931.png" alt=""></p>
<p><a name="_label2_2"></a></p>
<h3>3、访问文件</h3>
<p>简单的测试访问文件</p>
<p>① 修改nginx.conf</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># vim /usr/local/nginx/conf/nginx.conf

添加如下行，将 /group1/M00 映射到 /ljzsg/fastdfs/file/data
location /group1/M00 {
    alias /ljzsg/fastdfs/file/data;
}<br><br># 重启nginx<br># /usr/local/nginx/sbin/nginx -s reload</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011180543746-937678567.png" alt=""></p>
<p>② 在浏览器访问之前上传的图片、成功。</p>
<p>http://file.ljzsg.com/group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg</p>
<p>&nbsp;</p>
<div style="text-align: right;"><a style="color: #f68a33;" href="https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop">回到顶部</a><a name="_label3"></a></div>
<h2>四、FastDFS 配置 Nginx 模块</h2>
<p><a name="_label3_0"></a></p>
<h3>1、安装配置Nginx模块</h3>
<p>① fastdfs-nginx-module 模块说明</p>
<p>　　FastDFS 通过 Tracker 服务器，将文件放在 Storage 服务器存储， 但是同组存储服务器之间需要进行文件复制， 有同步延迟的问题。</p>
<p>　　假设 Tracker 服务器将文件上传到了 192.168.51.128，上传成功后文件 ID已经返回给客户端。</p>
<p>　　此时 FastDFS 存储集群机制会将这个文件同步到同组存储 192.168.51.129，在文件还没有复制完成的情况下，客户端如果用这个文件 ID 在 192.168.51.129 上取文件,就会出现文件无法访问的错误。</p>
<p>　　而 fastdfs-nginx-module 可以重定向文件链接到源服务器取文件，避免客户端由于复制延迟导致的文件无法访问错误。</p>
<p>② 下载&nbsp;fastdfs-nginx-module、解压</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># 这里为啥这么长一串呢，因为最新版的master与当前nginx有些版本问题。
# wget https://github.com/happyfish100/fastdfs-nginx-module/archive/5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip

# 解压
# unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip

# 重命名
# mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>③ 配置Nginx</p>
<p>在nginx中添加模块</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre># 先停掉nginx服务<br># /usr/local/nginx/sbin/nginx -s stop<br><br>进入解压包目录
# cd /softpackages/nginx-1.12.1/

# 添加模块
# ./configure --add-module=../fastdfs-nginx-module-master/src

重新编译、安装
# make &amp;&amp; make install</pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>&nbsp;④ 查看Nginx的模块</p>
<div class="cnblogs_code">
<pre># /usr/local/nginx/sbin/nginx -V</pre>
</div>
<p>有下面这个就说明添加模块成功</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011224125574-1739252073.png" alt=""></p>
<p>⑤ 复制 fastdfs-nginx-module 源码中的配置文件到/etc/fdfs 目录， 并修改</p>
<div class="cnblogs_code">
<pre># cd /softpackages/fastdfs-nginx-module-master/src<br><br># cp mod_fastdfs.conf /etc/fdfs/</pre>
</div>
<p>修改如下配置，其它默认</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #ff0000;"><span style="color: #000000;"># 连接超时时间<br>connect_timeout=10

# Tracker Server
<span style="color: #ff0000;">tracker_server=file.ljzsg.com:22122
<br># StorageServer 默认端口
storage_server_port=23000

# 如果文件ID的uri中包含/group**，则要设置为true
<span style="color: #ff0000;">url_have_group_name = true

# Storage 配置的store_path0路径，必须和storage.conf中的一致
<span style="color: #ff0000;">store_path0=/ljzsg/fastdfs/file</span></span></span></span></span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>⑥&nbsp;复制 FastDFS 的部分配置文件到/etc/fdfs 目录</p>
<div class="cnblogs_code">
<pre># cd /softpackages/fastdfs-5.05/conf/

# cp anti-steal.jpg http.conf mime.types /etc/fdfs/</pre>
</div>
<p>&nbsp;⑦ 配置nginx，修改nginx.conf</p>
<div class="cnblogs_code">
<pre># vim /usr/local/nginx/conf/nginx.conf</pre>
</div>
<p>修改配置，其它的默认</p>
<p>在80端口下添加fastdfs-nginx模块</p>
<div class="cnblogs_code">
<pre>location ~/group([0-9])/M00 {
    ngx_fastdfs_module;
}</pre>
</div>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011184247777-40074297.png" alt=""></p>
<p><span class="fontstyle0">注意：</span></p>
<p><span class="fontstyle0">　　listen 80&nbsp;<span class="fontstyle0">端口值是要与&nbsp;<span class="fontstyle0">/etc/fdfs/storage.conf <span class="fontstyle0">中的 <span class="fontstyle0">http.server_port=80 (前面改成80了)<span class="fontstyle0">相对应。如果改成其它端口，则需要统一，同时在防火墙中打开该端口。<span class="fontstyle0"><span class="fontstyle0"><br></span></span></span></span></span></span></span></span></p>
<p><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0"><span class="fontstyle0">　　location 的配置，如果有多个group则配置<span class="fontstyle0">location <span class="fontstyle0">~/group([0-9])/M00 ，没有则不用配group。</span></span></span></span></span></span></span></span></p>
<p>⑧&nbsp;<span class="fontstyle0">在/ljzsg/fastdfs/file 文件存储目录下创建软连接，将其链接到实际存放数据的目录，这一步可以省略。<br></span></p>
<div class="cnblogs_code">
<pre># ln -s /ljzsg/fastdfs/file/data/ /ljzsg/fastdfs/file/data/M00 </pre>
</div>
<p>⑨ 启动nginx</p>
<div class="cnblogs_code">
<pre># /usr/local/nginx/sbin/nginx</pre>
</div>
<p>打印处如下就算配置成功</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171011230509512-654301113.png" alt=""></p>
<p>⑩ 在地址栏访问。</p>
<p>能下载文件就算安装成功。注意和第三点中直接使用nginx路由访问不同的是，这里配置 fastdfs-nginx-module 模块，可以重定向文件链接到源服务器取文件。</p>
<p><span class="fontstyle0"><span class="fontstyle0">http://file.ljzsg.com/group1/M00/00/00/wKgz6lnduTeAMdrcAAEoRmXZPp870.jpeg</span></span></p>
<p>&nbsp;</p>
<p>最终部署结构图(盗的图)：可以按照下面的结构搭建环境。</p>
<p><img style="border: 1px solid black;" src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171012180511480-692747720.png" alt=""></p>
<p>&nbsp;</p>
<div style="text-align: right;"><a style="color: #f68a33;" href="https://www.cnblogs.com/chiangchou/p/fastdfs.html#_labelTop">回到顶部</a><a name="_label4"></a></div>
<h2>五、Java客户端</h2>
<p>前面文件系统平台搭建好了，现在就要写客户端代码在系统中实现上传下载，这里只是简单的测试代码。</p>
<p><a name="_label4_0"></a></p>
<h3>1、首先需要搭建 FastDFS 客户端Java开发环境</h3>
<p>① 项目中使用maven进行依赖管理，可以在pom.xml中引入如下依赖即可：</p>
<p>这是FASTDFS的pom文件https://gitee.com/gubin0412/FASTDFS</p>
<div class="cnblogs_code">
<pre>&lt;dependency&gt;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &lt;groupId&gt;fastdfs_client&lt;/groupId&gt;<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;artifactId&gt;fastdfs_client&lt;/artifactId&gt;<br>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &lt;version&gt;1.25&lt;/version&gt;<br>&nbsp;&lt;/dependency&gt;</pre>
</div>
<p>② 引入配置文件</p>
<p>可直接复制包下的 fastdfs-client.properties.sample 或者&nbsp;fdfs_client.conf.sample，到你的项目中，去掉.sample。</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171012112805371-395330483.png" alt=""></p>
<p>我这里直接复制 fastdfs-client.properties.sample 中的配置到项目配置文件 config.properties 中，修改tracker_servers。只需要加载这个配置文件即可</p>
<p><img src="./FastDFS搭建 - java-gubin - 博客园_files/856154-20171012120004199-247798219.png" alt=""></p>
<p><a name="_label4_1"></a></p>
<h3>2、客户端API</h3>
<p>个人封装的FastDFS Java API以同步到github：<a href="https://github.com/bojiangzhou/lyyzoo-fastdfs-java.git" target="_blank">https://github.com/bojiangzhou/lyyzoo-fastdfs-java.git</a></p>
<p>&nbsp;</p>
<p><a name="_label4_2"></a></p>
<h3>六、权限控制</h3>
<p>前面使用nginx支持http方式访问文件，但所有人都能直接访问这个文件服务器了，所以做一下权限控制。</p>
<p>FastDFS的权限控制是在服务端开启token验证，客户端根据文件名、当前unix时间戳、秘钥获取token，在地址中带上token参数即可通过http方式访问文件。</p>
<p>① 服务端开启token验证</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre>修改http.conf
# vim /etc/fdfs/http.conf

设置为true表示开启token验证
<span style="color: #ff0000;">http.anti_steal.check_token=true<br><br><span style="color: #000000;">设置token失效的时间单位为秒(s)<br>http.anti_steal.token_ttl=1800<br>
密钥，跟客户端配置文件的fastdfs.http_secret_key保持一致
<span style="color: #ff0000;">http.anti_steal.secret_key=FASTDFS1234567890

如果token检查失败，返回的页面
<span style="color: #ff0000;">http.anti_steal.token_check_fail=/ljzsg/fastdfs/page/403.html</span></span></span></span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>记得重启服务。</p>
<p>② 配置客户端</p>
<p>客户端只需要设置如下两个参数即可，两边的密钥保持一致。</p>
<div class="cnblogs_code">
<pre># token 防盗链功能
fastdfs.http_anti_steal_token=true
# 密钥
fastdfs.http_secret_key=FASTDFS1234567890</pre>
</div>
<p>③ 客户端生成token</p>
<p>访问文件需要带上生成的token以及unix时间戳，所以返回的token是token和时间戳的拼接。</p>
<p>之后，将token拼接在地址后即可访问：file.ljzsg.com/group1/M00/00/00/wKgzgFnkaXqAIfXyAAEoRmXZPp878.jpeg?token=078d370098b03e9020b82c829c205e1f&amp;ts=1508141521</p>
<div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><span style="color: #008080;"> 1     <span style="color: #008000;">/**
<span style="color: #008080;"> 2 <span style="color: #008000;">     * 获取访问服务器的token，拼接到地址后面
<span style="color: #008080;"> 3 <span style="color: #008000;">     *
<span style="color: #008080;"> 4 <span style="color: #008000;">     * <span style="color: #808080;">@param<span style="color: #008000;"> filepath 文件路径 group1/M00/00/00/wKgzgFnkTPyAIAUGAAEoRmXZPp876.jpeg
<span style="color: #008080;"> 5 <span style="color: #008000;">     * <span style="color: #808080;">@param<span style="color: #008000;"> httpSecretKey 密钥
<span style="color: #008080;"> 6 <span style="color: #008000;">     * <span style="color: #808080;">@return<span style="color: #008000;"> 返回token，如： token=078d370098b03e9020b82c829c205e1f&amp;ts=1508141521
<span style="color: #008080;"> 7      <span style="color: #008000;">*/
<span style="color: #008080;"> 8     <span style="color: #0000ff;">public <span style="color: #0000ff;">static<span style="color: #000000;"> String getToken(String filepath, String httpSecretKey){
<span style="color: #008080;"> 9         <span style="color: #008000;">//<span style="color: #008000;"> unix seconds
<span style="color: #008080;">10         <span style="color: #0000ff;">int ts = (<span style="color: #0000ff;">int<span style="color: #000000;">) Instant.now().getEpochSecond();
<span style="color: #008080;">11         <span style="color: #008000;">//<span style="color: #008000;"> token
<span style="color: #008080;">12         String token = "null"<span style="color: #000000;">;
<span style="color: #008080;">13         <span style="color: #0000ff;">try<span style="color: #000000;"> {
<span style="color: #008080;">14             token =<span style="color: #000000;"> ProtoCommon.getToken(getFilename(filepath), ts, httpSecretKey);
<span style="color: #008080;">15         } <span style="color: #0000ff;">catch<span style="color: #000000;"> (UnsupportedEncodingException e) {
<span style="color: #008080;">16 <span style="color: #000000;">            e.printStackTrace();
<span style="color: #008080;">17         } <span style="color: #0000ff;">catch<span style="color: #000000;"> (NoSuchAlgorithmException e) {
<span style="color: #008080;">18 <span style="color: #000000;">            e.printStackTrace();
<span style="color: #008080;">19         } <span style="color: #0000ff;">catch<span style="color: #000000;"> (MyException e) {
<span style="color: #008080;">20 <span style="color: #000000;">            e.printStackTrace();
<span style="color: #008080;">21 <span style="color: #000000;">        }
<span style="color: #008080;">22 
<span style="color: #008080;">23         StringBuilder sb = <span style="color: #0000ff;">new<span style="color: #000000;"> StringBuilder();
<span style="color: #008080;">24         sb.append("token="<span style="color: #000000;">).append(token);
<span style="color: #008080;">25         sb.append("&amp;ts="<span style="color: #000000;">).append(ts);
<span style="color: #008080;">26 
<span style="color: #008080;">27         <span style="color: #0000ff;">return<span style="color: #000000;"> sb.toString();
<span style="color: #008080;">28     }</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./FastDFS搭建 - java-gubin - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<p>④ 注意事项</p>
<p>如果生成的token验证无法通过，请进行如下两项检查：<br>　　A. 确认调用token生成函数(ProtoCommon.getToken)，传递的文件ID中没有包含group name。传递的文件ID格式形如：M00/00/00/wKgzgFnkTPyAIAUGAAEoRmXZPp876.jpeg</p>
<p>　　B. 确认服务器时间基本是一致的，注意服务器时间不能相差太多，不要相差到分钟级别。</p>
<p>⑤ 
对比下发现，如果系统文件隐私性较高，可以直接通过fastdfs-client提供的API去访问即可，不用再配置Nginx走http访问。配置Nginx的主要目的是为了快速访问服务器的文件(如图片)，如果还要加权限验证，则需要客户端生成token，其实已经没有多大意义。</p>
<p>关键是，这里我没找到FastDFS如何对部分资源加token验证，部分开放。有知道的还请留言。</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<hr>
<p>&nbsp;</p>
<p>OK，以上就是单机中使用FastDFS搭建文件系统并上传下载的过程。</p>
<p>完！！！</p>
<p>如果出现端口被占用 限制性查看 端口 lsof -i ：端口号 关闭：kill -9 端口号</p>
<p>&nbsp;</p>
<p>原文https://www.cnblogs.com/chiangchou/p/fastdfs.html</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="https://www.cnblogs.com/gu-bin/category/1433010.html" target="_blank">其他干货</a></div>
<div id="EntryTag"></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(10918552,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;f2170003-f2b4-48cd-1879-08d62da8ffcd&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./FastDFS搭建 - java-gubin - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./FastDFS搭建 - java-gubin - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/gu-bin/" target="_blank"><img src="./FastDFS搭建 - java-gubin - 博客园_files/20190425111211.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/gu-bin/">java-gubin</a><br>
            <a href="https://home.cnblogs.com/u/gu-bin/followees">关注 - 11</a><br>
            <a href="https://home.cnblogs.com/u/gu-bin/followers">粉丝 - 2</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;f2170003-f2b4-48cd-1879-08d62da8ffcd&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(10918552,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">0</span>
    </div>
    <div class="buryit" onclick="votePost(10918552,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
<script type="text/javascript">
    currentDiggType = 0;
</script></div>
<div class="clear"></div>
<div id="post_next_prev"><a href="https://www.cnblogs.com/gu-bin/p/10917894.html" class="p_n_p_prefix">« </a> 上一篇：<a href="https://www.cnblogs.com/gu-bin/p/10917894.html" title="发布于2019-05-24 14:13">volatile关键字的作用、原理</a><br><a href="https://www.cnblogs.com/gu-bin/p/10919944.html" class="p_n_p_prefix">» </a> 下一篇：<a href="https://www.cnblogs.com/gu-bin/p/10919944.html" title="发布于2019-05-24 19:56">Http状态码</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2019-05-24 15:48</span> <a href="https://www.cnblogs.com/gu-bin/">java-gubin</a> 阅读(<span id="post_view_count">44</span>) 评论(<span id="post_comment_count">0</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=10918552" rel="nofollow">编辑</a> <a href="https://www.cnblogs.com/gu-bin/p/10918552.html#" onclick="AddToWz(10918552);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=466167,cb_entryId=10918552,cb_blogApp=currentBlogApp,cb_blogUserGuid='f2170003-f2b4-48cd-1879-08d62da8ffcd',cb_entryCreatedDate='2019/5/24 15:48:00';loadViewCount(cb_entryId);var cb_postType=1;var isMarkdown=false;</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/gu-bin/p/10918552.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/gu-bin/p/10918552.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"></div>
<div id="opt_under_post"></div>
<script async="async" src="./FastDFS搭建 - java-gubin - 博客园_files/gpt.js.下载"></script>
<script>
  var googletag = googletag || {};
  googletag.cmd = googletag.cmd || [];
</script>
<script>
  googletag.cmd.push(function() {
        googletag.defineSlot('/1090369/C1', [300, 250], 'div-gpt-ad-1546353474406-0').addService(googletag.pubads());
        googletag.defineSlot('/1090369/C2', [468, 60], 'div-gpt-ad-1539008685004-0').addService(googletag.pubads());
        googletag.pubads().enableSingleRequest();
        googletag.enableServices();
  });
</script>
<div id="cnblogs_c1" class="c_ad_block">
    <div id="div-gpt-ad-1546353474406-0" style="height:250px; width:300px;"></div>
</div>
<div id="under_post_news" style="display: none;"></div>
<div id="cnblogs_c2" class="c_ad_block">
    <div id="div-gpt-ad-1539008685004-0" style="height:60px; width:468px;"></div>
</div>
<div id="under_post_kb"><div class="itnews c_ad_block"><b>最新新闻</b>：<br> ·  <a href="https://news.cnblogs.com/n/626716/" target="_blank">学问经得起时间考验的傅立叶</a><br> ·  <a href="https://news.cnblogs.com/n/626715/" target="_blank">美司法部警告科技巨头：没商业意义的收购视为垄断</a><br> ·  <a href="https://news.cnblogs.com/n/626714/" target="_blank">潜望| 2019年互联网趋势报告解读：中国互联网模式引领全球</a><br> ·  <a href="https://news.cnblogs.com/n/626713/" target="_blank">面部识别在美国面临更多的禁令吗？</a><br> ·  <a href="https://news.cnblogs.com/n/626712/" target="_blank">“星链”计划“污染”星空？</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
 if(enablePostBottom()) {
    codeHighlight();
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverT2();
    deliverC1();
    deliverC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);  
}
</script>
</div>

    
	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><div id="profile_block">昵称：<a href="https://home.cnblogs.com/u/gu-bin/">java-gubin</a><br>园龄：<a href="https://home.cnblogs.com/u/gu-bin/" title="入园时间：2018-10-09">8个月</a><br>粉丝：<a href="https://home.cnblogs.com/u/gu-bin/followers/">2</a><br>关注：<a href="https://home.cnblogs.com/u/gu-bin/followees/">11</a><div id="p_b_follow"></div><script>getFollowStatus('f2170003-f2b4-48cd-1879-08d62da8ffcd')</script></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/05/01&#39;);return false;">&lt;</a></td><td align="center">2019年6月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2019/07/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">26</td><td class="CalOtherMonthDay" align="center">27</td><td class="CalOtherMonthDay" align="center">28</td><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td><td class="CalOtherMonthDay" align="center">31</td><td class="CalWeekendDay" align="center"><a href="https://www.cnblogs.com/gu-bin/archive/2019/06/01.html"><u>1</u></a></td></tr><tr><td class="CalWeekendDay" align="center"><a href="https://www.cnblogs.com/gu-bin/archive/2019/06/02.html"><u>2</u></a></td><td align="center">3</td><td align="center">4</td><td align="center">5</td><td align="center">6</td><td align="center"><a href="https://www.cnblogs.com/gu-bin/archive/2019/06/07.html"><u>7</u></a></td><td class="CalWeekendDay" align="center"><a href="https://www.cnblogs.com/gu-bin/archive/2019/06/08.html"><u>8</u></a></td></tr><tr><td class="CalWeekendDay" align="center"><a href="https://www.cnblogs.com/gu-bin/archive/2019/06/09.html"><u>9</u></a></td><td align="center">10</td><td align="center"><a href="https://www.cnblogs.com/gu-bin/archive/2019/06/11.html"><u>11</u></a></td><td class="CalTodayDay" align="center">12</td><td align="center">13</td><td align="center">14</td><td class="CalWeekendDay" align="center">15</td></tr><tr><td class="CalWeekendDay" align="center">16</td><td align="center">17</td><td align="center">18</td><td align="center">19</td><td align="center">20</td><td align="center">21</td><td class="CalWeekendDay" align="center">22</td></tr><tr><td class="CalWeekendDay" align="center">23</td><td align="center">24</td><td align="center">25</td><td align="center">26</td><td align="center">27</td><td align="center">28</td><td class="CalWeekendDay" align="center">29</td></tr><tr><td class="CalWeekendDay" align="center">30</td><td class="CalOtherMonthDay" align="center">1</td><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>
<div id="widget_my_google" class="div_my_zzk"><input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event)" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk"></div>
</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<div class="catListLink">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="https://www.cnblogs.com/gu-bin/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="https://www.cnblogs.com/gu-bin/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="https://www.cnblogs.com/gu-bin/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="https://www.cnblogs.com/gu-bin/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="https://www.cnblogs.com/gu-bin/tag/" title="我的博客的标签列表">我的标签</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">
<ul>

</ul>
</div>
</div></div><div id="sidebar_toptags" class="sidebar-block">
<div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
<li><a href="https://www.cnblogs.com/gu-bin/tag/java/">java</a>(1)</li><li><a href="https://www.cnblogs.com/gu-bin/tag/%E5%8F%A4%E6%96%8C/">古斌</a>(1)</li><li><a href="https://www.cnblogs.com/gu-bin/tag/%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/">基本数据类型</a>(1)</li><li><a href="https://www.cnblogs.com/gu-bin/tag/%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/">类和对象</a>(1)</li><li><a href="https://www.cnblogs.com/gu-bin/tag/%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%B0%83%E7%94%A8/">引用数据类型调用</a>(1)</li>
</ul>
</div></div><div id="sidebar_categories">
<div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
<h3 class="catListTitle">随笔分类</h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="https://www.cnblogs.com/gu-bin/category/1403507.html">hibernate框架(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="https://www.cnblogs.com/gu-bin/category/1398252.html">IDEA(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="https://www.cnblogs.com/gu-bin/category/1335197.html">java(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="https://www.cnblogs.com/gu-bin/category/1435950.html">javascript(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_4" href="https://www.cnblogs.com/gu-bin/category/1435944.html">javaweb(html+css+js+servlrt....)(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_5" href="https://www.cnblogs.com/gu-bin/category/1400992.html">jsp(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_6" href="https://www.cnblogs.com/gu-bin/category/1449716.html">Linux(9)</a> </li>

<li><a id="CatList_LinkList_0_Link_7" href="https://www.cnblogs.com/gu-bin/category/1412764.html">mybatis(9)</a> </li>

<li><a id="CatList_LinkList_0_Link_8" href="https://www.cnblogs.com/gu-bin/category/1398290.html">Mysql(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_9" href="https://www.cnblogs.com/gu-bin/category/1434403.html">Oracle(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_10" href="https://www.cnblogs.com/gu-bin/category/1408960.html">Spring(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_11" href="https://www.cnblogs.com/gu-bin/category/1418682.html">Spring_MVC(7)</a> </li>

<li><a id="CatList_LinkList_0_Link_12" href="https://www.cnblogs.com/gu-bin/category/1480140.html">SpringBoot系列(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_13" href="https://www.cnblogs.com/gu-bin/category/1406460.html">struts2(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_14" href="https://www.cnblogs.com/gu-bin/category/1478450.html">大数据(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_15" href="https://www.cnblogs.com/gu-bin/category/1433010.html">其他干货(13)</a> </li>

<li><a id="CatList_LinkList_0_Link_16" href="https://www.cnblogs.com/gu-bin/category/1474643.html">实用技术&amp;&amp;工具(2)</a> </li>

</ul>

</div>

<div id="sidebar_postarchive" class="catListPostArchive sidebar-block">
<h3 class="catListTitle">随笔档案</h3>

<ul>

<li><a id="CatList_LinkList_1_Link_0" href="https://www.cnblogs.com/gu-bin/archive/2019/06.html">2019年6月 (8)</a> </li>

<li><a id="CatList_LinkList_1_Link_1" href="https://www.cnblogs.com/gu-bin/archive/2019/05.html">2019年5月 (9)</a> </li>

<li><a id="CatList_LinkList_1_Link_2" href="https://www.cnblogs.com/gu-bin/archive/2019/04.html">2019年4月 (14)</a> </li>

<li><a id="CatList_LinkList_1_Link_3" href="https://www.cnblogs.com/gu-bin/archive/2019/03.html">2019年3月 (28)</a> </li>

<li><a id="CatList_LinkList_1_Link_4" href="https://www.cnblogs.com/gu-bin/archive/2019/02.html">2019年2月 (9)</a> </li>

<li><a id="CatList_LinkList_1_Link_5" href="https://www.cnblogs.com/gu-bin/archive/2019/01.html">2019年1月 (4)</a> </li>

<li><a id="CatList_LinkList_1_Link_6" href="https://www.cnblogs.com/gu-bin/archive/2018/12.html">2018年12月 (7)</a> </li>

<li><a id="CatList_LinkList_1_Link_7" href="https://www.cnblogs.com/gu-bin/archive/2018/11.html">2018年11月 (25)</a> </li>

<li><a id="CatList_LinkList_1_Link_8" href="https://www.cnblogs.com/gu-bin/archive/2018/10.html">2018年10月 (7)</a> </li>

</ul>

</div>

</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>

	<div id="RecentCommentsBlock"></div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock"></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock"></div>
</div>
</div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">推荐排行榜</h3>
<div id="TopDiggPostsBlock"></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2019 java-gubin
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->

<!--PageEndHtml Block Begin-->
<span id="back-to-top"><a href="https://www.cnblogs.com/gu-bin/p/10918552.html#top"><img src="./FastDFS搭建 - java-gubin - 博客园_files/u=2303550390,3222189618&amp;fm=206&amp;gp=0.jpg" style="width: 80px; height: 80px">欢迎来到古斌的小窝</a></span>
<!--PageEndHtml Block End-->


</body></html>